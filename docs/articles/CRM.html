<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Continual Reassessment Method • trialr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Continual Reassessment Method">
<meta property="og:description" content="trialr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trialr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/BEBOP.html">BEBOP in PePS2</a>
    </li>
    <li>
      <a href="../articles/CRM-pathways.html">Dose pathways with CRM</a>
    </li>
    <li>
      <a href="../articles/CRM-visualisation.html">Visualisation with CRM</a>
    </li>
    <li>
      <a href="../articles/CRM.html">Continual Reassessment Method</a>
    </li>
    <li>
      <a href="../articles/EffTox.html">EffTox</a>
    </li>
    <li>
      <a href="../articles/HierarchicalBayesianResponse.html">Hierarchical Bayesian Model for Binary Responses</a>
    </li>
    <li>
      <a href="../articles/LevyCaseStudy.html">CRM Case Study 1 - Levy et al (2006)</a>
    </li>
    <li>
      <a href="../articles/TITE-CRM.html">Time-to-Event Continual Reassessment Method</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/brockk/trialr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Continual Reassessment Method</h1>
                        <h4 class="author">Kristian Brock</h4>
            
            <h4 class="date">2020-04-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/brockk/trialr/blob/master/vignettes/CRM.Rmd"><code>vignettes/CRM.Rmd</code></a></small>
      <div class="hidden name"><code>CRM.Rmd</code></div>

    </div>

    
    
<p>The Continual Reassessment Method (CRM) is the elder statesman of adaptive clinical trials. Originally published by <span class="citation">O’Quigley, Pepe, and Fisher (1990)</span>, it assumes a smooth mathematical form for the dose-toxicity curve to conduct a dose-finding trial seeking a maximum tolerable dose (MTD). It is a truly seminal design, with many variants appearing over the years to handle different clinical scenarios, such as seperate groups, late-onset toxicity, efficacy and toxicity outcomes, and more.</p>
<p>In this vignette, we focus on the original Bayesian design that seeks the MTD in an homogeneous patient group. Let <span class="math inline">\(x_i\)</span> be a standardised dose-level. The probability of <em>dose-limiting toxicity</em> (DLT) at dose <span class="math inline">\(x_i\)</span> is estimated to be <span class="math inline">\(F(x_i, \theta)\)</span>, where <span class="math inline">\(F\)</span> is a smooth mathematical function, and <span class="math inline">\(\theta\)</span> is a general vector of parameters. Even within this simple scenario, there are variants that use different forms for <span class="math inline">\(F\)</span>, and different distributions on <span class="math inline">\(\theta\)</span>.</p>
<p>Let <span class="math inline">\(Y_i\)</span> be a random variable taking values <span class="math inline">\(\{0, 1\}\)</span> reflecting the absence and presence of DLT respectively in patient <span class="math inline">\(i\)</span>. A patient administered dose <span class="math inline">\(x_i\)</span> has estimated probability of toxicity <span class="math inline">\(F(x_i, \theta)\)</span> so that the likelihood component arising from patient <span class="math inline">\(i\)</span> is</p>
<p><span class="math display">\[ F(x_i, \theta)^{Y_i} (1 - F(x_i, \theta))^{1-Y_i} \]</span></p>
<p>After the evaluation of <span class="math inline">\(J\)</span> patients, the aggregate likelihood is:</p>
<p><span class="math display">\[ L_J(\theta) = \prod_{i=1}^J \left\{ F(x_i, \theta) \right\}^{Y_i} \left\{ 1 - F(x_i, \theta) \right\}^{1-Y_i} \]</span></p>
<p>This quantity can either be maximised with respect to <span class="math inline">\(\theta\)</span> to obtain maximum likelihood estimate, or augmented with priors and analysed in a Bayesian way. CRM was originally published as a Bayesian design and that is the approach we take here in <code>trialr</code> using Stan.</p>
<p>The CRM variants currently implemented in <code>trialr</code> for MTD-finding in a single homogeneous group are:</p>
<table class="table">
<colgroup>
<col width="38%">
<col width="44%">
<col width="17%">
</colgroup>
<thead><tr class="header">
<th><code>model</code></th>
<th align="center">Link Function</th>
<th align="right">Parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>empiric</code></td>
<td align="center">
<span class="math inline">\(F(x_i, \beta)\)</span> = <span class="math inline">\(x_i^{\exp{\beta}}\)</span>
</td>
<td align="right">normal prior on <span class="math inline">\(\beta\)</span>;</td>
</tr>
<tr class="even">
<td><code>logistic</code></td>
<td align="center"><span class="math inline">\(F(x_i, \beta) = 1 / (1 + \exp{(-a_0 - \exp{(\beta)} x_i}))\)</span></td>
<td align="right">
<span class="math inline">\(a_0\)</span> fixed and a normal prior on <span class="math inline">\(\beta\)</span>
</td>
</tr>
<tr class="odd">
<td><code>logistic_gamma</code></td>
<td align="center"><span class="math inline">\(F(x_i, \beta) = 1 / (1 + \exp{(-a_0 - \beta x_i)})\)</span></td>
<td align="right">
<span class="math inline">\(a_0\)</span> fixed and a gamma prior on <span class="math inline">\(\beta\)</span>
</td>
</tr>
<tr class="even">
<td><code>logistic2</code></td>
<td align="center"><span class="math inline">\(F(x_i, \alpha, \beta) = 1 / (1 + \exp{(-\alpha - \exp{(\beta)} x_i)})\)</span></td>
<td align="right">normal priors on <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>
</td>
</tr>
</tbody>
</table>
<p>These models are compiled when you install <code>trialr</code> and accessed via the <code>stan_crm</code> function. For instance, to fit the empiric model one would use <code>model = 'empiric'</code>. Examples are given below.</p>
<p>Where necessary, the slope parameter <span class="math inline">\(\beta\)</span> is exponentiated to ensure a positive value. One of the core assumptions of the CRM and dose-escalation methods in general, is that the probability of toxicity increases with dose. If a negative value for <span class="math inline">\(\beta\)</span> is non-sensical, we should reflect that in the model parameterisation. In the model with gamma prior, this step is not necessary because the prior constrains the values to be positive.</p>
<p>Other CRM variants could easily be added in future, if requested. For instance, <span class="citation">Cheung (2011)</span> defines a model that uses the hyperbolic tangent link function, but we have not implemented it here because we have never required it.</p>
<div id="usage" class="section level1">
<h1 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h1>
<p>Let’s conduct some examples.</p>
<p>To access the Stan implementations of the CRM, we must load <code>trialr</code>:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">trialr</span>)</pre></body></html></div>
<p>For illustration, we consider a scenario where we investigate 5 dose-levels seeking the dose with Pr(DLT) closest to 25%. We will assume that our <em>skeleton</em> (i.e. our prior belief of the dose-toxicity curve) is</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">target</span> <span class="kw">&lt;-</span> <span class="fl">0.25</span>
<span class="no">skeleton</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.15</span>, <span class="fl">0.25</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>)</pre></body></html></div>
<p>Say that we have treated 6 patients at 3 dose-levels:</p>
<table class="table">
<thead><tr class="header">
<th align="center">Patient</th>
<th align="center">Cohort</th>
<th align="center">Dose-level</th>
<th align="center">DLT</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>These data can be conveyed using a simple nomenclature for phase I outcomes. We use integers to represent dose-levels given and the letters T and N to represent toxicity or no-toxicity for individual patients. These clusters can be strewn together to represent the outcomes of cohorts of patients. For instance, the outcomes above can be represented:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">outcomes</span> <span class="kw">&lt;-</span> <span class="st">'2NN 3NN 4TT'</span></pre></body></html></div>
<p>We will update each of the CRM models implemented in <code>trialr</code> for this scenario. We then briefly compare the inferences at the end.</p>
<div id="empiric-model" class="section level2">
<h2 class="hasAnchor">
<a href="#empiric-model" class="anchor"></a>Empiric model</h2>
<p>The empiric model requires only that a prior normal standard deviation be specified for the slope parameter. We use a prior variance of <span class="math inline">\(\beta\)</span> equal to 1.34, as used by Cheung in his examples.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">fit1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stan_crm.html">stan_crm</a></span>(<span class="no">outcomes</span>, <span class="kw">skeleton</span> <span class="kw">=</span> <span class="no">skeleton</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">target</span>,
                 <span class="kw">model</span> <span class="kw">=</span> <span class="st">'empiric'</span>, <span class="kw">beta_sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fl">1.34</span>), <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">123</span>)</pre></body></html></div>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">fit1</span>
<span class="co">#&gt;   Patient Dose Toxicity Weight</span>
<span class="co">#&gt; 1       1    2        0      1</span>
<span class="co">#&gt; 2       2    2        0      1</span>
<span class="co">#&gt; 3       3    3        0      1</span>
<span class="co">#&gt; 4       4    3        0      1</span>
<span class="co">#&gt; 5       5    4        1      1</span>
<span class="co">#&gt; 6       6    4        1      1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Dose Skeleton N Tox ProbTox MedianProbTox ProbMTD</span>
<span class="co">#&gt; 1    1     0.05 0   0   0.108        0.0726  0.2140</span>
<span class="co">#&gt; 2    2     0.15 2   0   0.216        0.1900  0.2717</span>
<span class="co">#&gt; 3    3     0.25 2   0   0.310        0.2972  0.2657</span>
<span class="co">#&gt; 4    4     0.40 2   2   0.444        0.4484  0.2090</span>
<span class="co">#&gt; 5    5     0.60 0   0   0.624        0.6395  0.0395</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model targets a toxicity level of 0.25.</span>
<span class="co">#&gt; The dose with estimated toxicity probability closest to target is 2.</span>
<span class="co">#&gt; The dose most likely to be the MTD is 2.</span>
<span class="co">#&gt; Model entropy: 1.49</span></pre></body></html></div>
<p>In this demonstration, we set the seed for reproducibility when sampling however, in the wild, you might not do this.</p>
<p>We can extract the samples of the posterior probability of DLT at each dose, stored as the series of parameters called <code>prob_tox</code>. From there, all manner of inference is possible. For example, we can recreate the posterior expected probability of DLT at each dose shown above. It is simply the mean of each sample:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">prob_tox_samp1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">fit1</span>, <span class="st">'prob_tox'</span>)
<span class="no">prob_tox1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span>(<span class="no">prob_tox_samp1</span>)
<span class="no">prob_tox1</span>
<span class="co">#&gt; prob_tox[1] prob_tox[2] prob_tox[3] prob_tox[4] prob_tox[5] </span>
<span class="co">#&gt;   0.1081169   0.2159618   0.3098591   0.4444842   0.6235105</span></pre></body></html></div>
<p>This confirms that dose-level 2 is closest to our toxicity target of 25%. Having posterior samples is very liberating from an inferential point of view. For example, it is trivial to calculate the probability that the toxicity rate exceeds the target DLT probability at each dose:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">prob_too_toxic1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span>(<span class="no">prob_tox_samp1</span> <span class="kw">&gt;</span> <span class="no">target</span>))
<span class="no">prob_too_toxic1</span>
<span class="co">#&gt; [1] 0.11700 0.35725 0.60075 0.86500 0.99150</span></pre></body></html></div>
<p>Even at this early stage, we are quite sure that the top dose is too toxic. This type of calculation is trivial because we have access to the posterior samples.</p>
</div>
<div id="one-parameter-logisitic-model-with-normal-prior" class="section level2">
<h2 class="hasAnchor">
<a href="#one-parameter-logisitic-model-with-normal-prior" class="anchor"></a>One parameter logisitic model with normal prior</h2>
<p>This model requires that a fixed intercept value and parameters for the normal prior on the slope term are specified:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">fit2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stan_crm.html">stan_crm</a></span>(<span class="no">outcomes</span>, <span class="kw">skeleton</span> <span class="kw">=</span> <span class="no">skeleton</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">target</span>,
                 <span class="kw">model</span> <span class="kw">=</span> <span class="st">'logistic'</span>, <span class="kw">a0</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">beta_mean</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">beta_sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fl">1.34</span>),
                 <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">123</span>)</pre></body></html></div>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">fit2</span>
<span class="co">#&gt;   Patient Dose Toxicity Weight</span>
<span class="co">#&gt; 1       1    2        0      1</span>
<span class="co">#&gt; 2       2    2        0      1</span>
<span class="co">#&gt; 3       3    3        0      1</span>
<span class="co">#&gt; 4       4    3        0      1</span>
<span class="co">#&gt; 5       5    4        1      1</span>
<span class="co">#&gt; 6       6    4        1      1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Dose Skeleton N Tox ProbTox MedianProbTox ProbMTD</span>
<span class="co">#&gt; 1    1     0.05 0   0   0.119        0.0761   0.255</span>
<span class="co">#&gt; 2    2     0.15 2   0   0.235        0.2013   0.261</span>
<span class="co">#&gt; 3    3     0.25 2   0   0.328        0.3122   0.248</span>
<span class="co">#&gt; 4    4     0.40 2   2   0.455        0.4628   0.190</span>
<span class="co">#&gt; 5    5     0.60 0   0   0.624        0.6458   0.046</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model targets a toxicity level of 0.25.</span>
<span class="co">#&gt; The dose with estimated toxicity probability closest to target is 2.</span>
<span class="co">#&gt; The dose most likely to be the MTD is 2.</span>
<span class="co">#&gt; Model entropy: 1.50</span></pre></body></html></div>
<p>Once again, we see that dose-level 2 would be recommended for the next cohort because it is forecast to have Pr(DLT) closest to the target, 25%.</p>
</div>
<div id="one-parameter-logisitic-model-with-gamma-prior" class="section level2">
<h2 class="hasAnchor">
<a href="#one-parameter-logisitic-model-with-gamma-prior" class="anchor"></a>One parameter logisitic model with gamma prior</h2>
<p>This model requires that a fixed intercept value and parameters for the gamma prior on the slope term are specified:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">fit3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stan_crm.html">stan_crm</a></span>(<span class="no">outcomes</span>, <span class="kw">skeleton</span> <span class="kw">=</span> <span class="no">skeleton</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">target</span>,
                 <span class="kw">model</span> <span class="kw">=</span> <span class="st">'logistic_gamma'</span>,
                 <span class="kw">a0</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">beta_shape</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_inverse_scale</span> <span class="kw">=</span> <span class="fl">1</span>,
                 <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">123</span>)</pre></body></html></div>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">fit3</span>
<span class="co">#&gt;   Patient Dose Toxicity Weight</span>
<span class="co">#&gt; 1       1    2        0      1</span>
<span class="co">#&gt; 2       2    2        0      1</span>
<span class="co">#&gt; 3       3    3        0      1</span>
<span class="co">#&gt; 4       4    3        0      1</span>
<span class="co">#&gt; 5       5    4        1      1</span>
<span class="co">#&gt; 6       6    4        1      1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Dose Skeleton N Tox ProbTox MedianProbTox ProbMTD</span>
<span class="co">#&gt; 1    1     0.05 0   0   0.119         0.071  0.2480</span>
<span class="co">#&gt; 2    2     0.15 2   0   0.233         0.192  0.2460</span>
<span class="co">#&gt; 3    3     0.25 2   0   0.324         0.301  0.2590</span>
<span class="co">#&gt; 4    4     0.40 2   2   0.451         0.452  0.2003</span>
<span class="co">#&gt; 5    5     0.60 0   0   0.621         0.638  0.0467</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model targets a toxicity level of 0.25.</span>
<span class="co">#&gt; The dose with estimated toxicity probability closest to target is 2.</span>
<span class="co">#&gt; The dose most likely to be the MTD is 3.</span>
<span class="co">#&gt; Model entropy: 1.51</span></pre></body></html></div>
<p>This use of a Gamma(1, 1) prior is the same as an Exponential(1) prior.</p>
</div>
<div id="two-parameter-logisitic-model-with-normal-priors" class="section level2">
<h2 class="hasAnchor">
<a href="#two-parameter-logisitic-model-with-normal-priors" class="anchor"></a>Two parameter logisitic model with normal priors</h2>
<p>This model requires that parameters for normal priors on the intercept and slope term are specified:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">fit4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stan_crm.html">stan_crm</a></span>(<span class="no">outcomes</span>, <span class="kw">skeleton</span> <span class="kw">=</span> <span class="no">skeleton</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">target</span>,
                 <span class="kw">model</span> <span class="kw">=</span> <span class="st">'logistic2'</span>,
                 <span class="kw">alpha_mean</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">alpha_sd</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_mean</span> <span class="kw">=</span>  <span class="fl">0</span>, <span class="kw">beta_sd</span> <span class="kw">=</span> <span class="fl">1</span>,
                 <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">123</span>)</pre></body></html></div>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">fit4</span>
<span class="co">#&gt;   Patient Dose Toxicity Weight</span>
<span class="co">#&gt; 1       1    2        0      1</span>
<span class="co">#&gt; 2       2    2        0      1</span>
<span class="co">#&gt; 3       3    3        0      1</span>
<span class="co">#&gt; 4       4    3        0      1</span>
<span class="co">#&gt; 5       5    4        1      1</span>
<span class="co">#&gt; 6       6    4        1      1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Dose Skeleton N Tox ProbTox MedianProbTox ProbMTD</span>
<span class="co">#&gt; 1    1     0.05 0   0   0.066        0.0187  0.1148</span>
<span class="co">#&gt; 2    2     0.15 2   0   0.139        0.0948  0.1658</span>
<span class="co">#&gt; 3    3     0.25 2   0   0.230        0.2058  0.3882</span>
<span class="co">#&gt; 4    4     0.40 2   2   0.427        0.4230  0.2935</span>
<span class="co">#&gt; 5    5     0.60 0   0   0.692        0.7157  0.0377</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model targets a toxicity level of 0.25.</span>
<span class="co">#&gt; The dose with estimated toxicity probability closest to target is 3.</span>
<span class="co">#&gt; The dose most likely to be the MTD is 3.</span>
<span class="co">#&gt; Model entropy: 1.40</span></pre></body></html></div>
<p>These estimates look different to the other methods, not least because we have estimated an extra parameter. We compare the inferences in the next section.</p>
</div>
<div id="comparison" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison" class="anchor"></a>Comparison</h2>
<p>Let’s compare the posterior estimates of the dose-toxicity curve:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">post_curves</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">DoseLevel</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">skeleton</span>),
  <span class="kw">Empiric</span> <span class="kw">=</span> <span class="no">fit1</span>$<span class="no">prob_tox</span>,
  <span class="kw">Logit1N</span> <span class="kw">=</span> <span class="no">fit2</span>$<span class="no">prob_tox</span>,
  <span class="kw">Logit1G</span> <span class="kw">=</span> <span class="no">fit3</span>$<span class="no">prob_tox</span>,
  <span class="kw">Logit2N</span> <span class="kw">=</span> <span class="no">fit4</span>$<span class="no">prob_tox</span>
)
<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="no">post_curves</span>, <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">DoseLevel</th>
<th align="right">Empiric</th>
<th align="right">Logit1N</th>
<th align="right">Logit1G</th>
<th align="right">Logit2N</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.11</td>
<td align="right">0.12</td>
<td align="right">0.12</td>
<td align="right">0.07</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.22</td>
<td align="right">0.23</td>
<td align="right">0.23</td>
<td align="right">0.14</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.31</td>
<td align="right">0.33</td>
<td align="right">0.32</td>
<td align="right">0.23</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.44</td>
<td align="right">0.46</td>
<td align="right">0.45</td>
<td align="right">0.43</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.62</td>
<td align="right">0.62</td>
<td align="right">0.62</td>
<td align="right">0.69</td>
</tr>
</tbody>
</table>
<p>It is perhaps no surprise that the three single-parameter models (<code>Empiric</code>, <code>Logit1N</code>, &amp; <code>Logit1G</code>) provide very similar estimates and agree that the dose closest to the target is dose-level 2. In contrast, the two-parameter model estimates a more convex curve, and proposes dose-level 3 for the next patient(s). Let’s have a look at that graphically:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">post_curves_tall</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">DoseLevel</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">skeleton</span>), <span class="kw">times</span> <span class="kw">=</span> <span class="fl">4</span>),
  <span class="kw">ProbTox</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">fit1</span>$<span class="no">prob_tox</span>, <span class="no">fit2</span>$<span class="no">prob_tox</span>, <span class="no">fit3</span>$<span class="no">prob_tox</span>, <span class="no">fit4</span>$<span class="no">prob_tox</span>),
  <span class="kw">Model</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Empiric'</span>, <span class="st">'Logit1N'</span>, <span class="st">'Logit1G'</span>, <span class="st">'Logit2N'</span>), <span class="kw">each</span> <span class="kw">=</span> <span class="fl">5</span>)
)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">post_curves_tall</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">DoseLevel</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">ProbTox</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">Model</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">Model</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.2</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">target</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'red'</span>, <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">'dashed'</span>)</pre></body></html></div>
<p><img src="CRM_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<p>If we suspect that the difference in inference might be driven by our prior for <span class="math inline">\(\alpha\)</span> in the two-parameter model, we can look at a summary of the posterior samples for that parameter:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw pkg">rstan</span><span class="kw ns">::</span><span class="fu">summary</span>(<span class="no">fit4</span>$<span class="no">fit</span>, <span class="st">'alpha'</span>)$<span class="no">summary</span>, <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="right">mean</th>
<th align="right">se_mean</th>
<th align="right">sd</th>
<th align="right">2.5%</th>
<th align="right">25%</th>
<th align="right">50%</th>
<th align="right">75%</th>
<th align="right">97.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat</th>
</tr></thead>
<tbody><tr class="odd">
<td>alpha</td>
<td align="right">0.35</td>
<td align="right">0.02</td>
<td align="right">0.85</td>
<td align="right">-1.28</td>
<td align="right">-0.23</td>
<td align="right">0.34</td>
<td align="right">0.92</td>
<td align="right">2.1</td>
<td align="right">1447.58</td>
<td align="right">1</td>
</tr></tbody>
</table>
<p>The posterior mean is not near the tail of the <span class="math inline">\(N(0, 1)\)</span> prior distribution and the posterior 95% credible interval has relocated from prior guess of (-2, 2). The prior on <span class="math inline">\(\alpha\)</span> does not appear to be unduly driving the divergence from the one-parameter models.</p>
</div>
<div id="are-we-interested-in-prdlt-or-prmtd" class="section level2">
<h2 class="hasAnchor">
<a href="#are-we-interested-in-prdlt-or-prmtd" class="anchor"></a>Are we interested in Pr(DLT) or Pr(MTD)?</h2>
<p>The traditional method of inference using the CRM has been to estimate the expected dose-toxicity curve and infer the suggested dose by identifying which is estimated to have toxicity rate closest to the target. This has partly been for computational convenience. Without MCMC, it has been simple to estimate the posterior mean(s) of the model parameter(s) and plug these into <span class="math inline">\(F(.)\)</span>.</p>
<p>However, with Stan we can take a different approach. We have many possible realities sampled from the posterior distributions. For instance, each Stan-fit samples many possible dose-toxicity curves, in accordance with the model and priors specified and the data observed. With each sampled dose-toxicity curve we can calculate the dose that is closest to the target. Thus, each posterior dose-toxicity curves identifies a candidate MTD. The frequency with which the doses occur reflects the posterior probability that each dose is the MTD. This is probably what we really want when we conduct an MTD-seeking clinical trial.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
    <span class="kw">DoseLevel</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">skeleton</span>),
    <span class="kw">ProbMTD_Empiric</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">fit1</span>$<span class="no">prob_mtd</span>),
    <span class="kw">ProbMTD_Logit2N</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">fit4</span>$<span class="no">prob_mtd</span>)
  ), <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">2</span>
)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">DoseLevel</th>
<th align="right">ProbMTD_Empiric</th>
<th align="right">ProbMTD_Logit2N</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.21</td>
<td align="right">0.11</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.27</td>
<td align="right">0.17</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.27</td>
<td align="right">0.39</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.21</td>
<td align="right">0.29</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.04</td>
<td align="right">0.04</td>
</tr>
</tbody>
</table>
<p>The empiric model (<code>fit1</code>) is actually relatively ambivalent between the first four dose-levels, assigning each roughly the same probability of being the MTD. The other one-parameter models are similar (not shown). In contrast, the two-parameter model (<code>fit4</code>) is actually more confident in its choice of dose-level 3. However, none of the models is particularly confident and this should not surprise us as we have only observed 6 patients.</p>
</div>
<div id="other-crm-vignettes" class="section level2">
<h2 class="hasAnchor">
<a href="#other-crm-vignettes" class="anchor"></a>Other CRM vignettes</h2>
<p>There are many vignettes illuminating the CRM in <code>trialr</code>:</p>
<ul>
<li><a href="CRM.html">An introduction to CRM in ‘trialr’</a></li>
<li><a href="CRM-visualisation.html">Visualisation in CRM</a></li>
<li><a href="TITE-CRM.html">TITE-CRM</a></li>
<li><a href="CRM-pathways.html">Pathways and stopping in CRM</a></li>
<li><a href="LevyCaseStudy.html">Case study using Levy, et al. (2006)</a></li>
<li>Simulation</li>
</ul>
</div>
</div>
<div id="trialr" class="section level1">
<h1 class="hasAnchor">
<a href="#trialr" class="anchor"></a>trialr</h1>
<p><code>trialr</code> is available at <a href="https://github.com/brockk/trialr" class="uri">https://github.com/brockk/trialr</a> and <a href="https://CRAN.R-project.org/package=trialr" class="uri">https://CRAN.R-project.org/package=trialr</a></p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Cheung2011">
<p>Cheung, Ying Kuen. 2011. <em>Dose Finding by the Continual Reassessment Method</em>. New York: Chapman &amp; Hall / CRC Press.</p>
</div>
<div id="ref-OQuigley1990">
<p>O’Quigley, J, M Pepe, and L Fisher. 1990. “Continual Reassessment Method: A Practical Design for Phase 1 Clinical Trials in Cancer.” <em>Biometrics</em> 46 (1): 33–48. <a href="https://doi.org/10.2307/2531628">https://doi.org/10.2307/2531628</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kristian Brock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
