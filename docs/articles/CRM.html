<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Continual Reassessment Method in <code>trialr</code> • trialr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">trialr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/trialr.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CRM.html">Continual Reassessment Method in `trialr`</a>
    </li>
    <li>
      <a href="../articles/EffTox.html">EffTox in trialr</a>
    </li>
    <li>
      <a href="../articles/HierarchicalBayesianResponse.html">Hierarchical Bayesian Model for Binary Responses</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/brockk/trialr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Continual Reassessment Method in <code>trialr</code>
</h1>
                        <h4 class="author">Kristian Brock</h4>
            
            <h4 class="date">2018-03-04</h4>
          </div>

    
    
<div class="contents">
<p>The Continual Reassessment Method is the grand archduke of adaptive clinical trials. Originally published by <span class="citation">O’Quigley, Pepe, and Fisher (1990)</span>, it assumes a smooth mathematical form for the dose-toxicity curve to conduct a dose-finding trial seeking a maximum tolerable dose. It is a truly seminal design, with many variants appearing over the years to handle different clinical scenarios, such as seperate groups, late-onset toxicity, efficacy and toxicity outcomes, etc.</p>
<p>In this vignette, we focus on the original Bayesian MTD-seeking design in one homogeneous group. Let <span class="math inline">\(x_i\)</span> be a standardised dose-level. The probability of DLT at dose <span class="math inline">\(x_i\)</span> is estimated to be <span class="math inline">\(F(x_i, \theta)\)</span>, where <span class="math inline">\(F\)</span> is the smooth mathematical function, and <span class="math inline">\(\theta\)</span> is a general vector of parameters. Even within this simple scenario, there are variants that use different forms for <span class="math inline">\(F\)</span>, and different distributions on <span class="math inline">\(\theta\)</span>.</p>
<p>The CRM variants currently implemented in <code>trialr</code> for MTD-finding in a single homogeneous group are:</p>
<table style="width:51%;" class="table">
<colgroup>
<col width="19%">
<col width="22%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th>
<code>trialr</code> model</th>
<th align="center">Link Function</th>
<th align="right">Parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>stanmodels$CrmEmpiricNormalPrior</code></td>
<td align="center">
<span class="math inline">\(F(x_i, \beta)\)</span> = <span class="math inline">\(x_i^{\exp{\beta}}\)</span>
</td>
<td align="right">normal prior on <span class="math inline">\(\beta\)</span>;</td>
</tr>
<tr class="even">
<td><code>stanmodels$CrmOneParamLogisticNormalPrior</code></td>
<td align="center"><span class="math inline">\(F(x_i, \beta) = 1 / (1 + \exp{(-a_0 - \beta x_i}))\)</span></td>
<td align="right">
<span class="math inline">\(a_0\)</span> fixed and a normal prior on <span class="math inline">\(\beta\)</span>
</td>
</tr>
<tr class="odd">
<td><code>stanmodels$CrmOneParamLogisticGammaPrior</code></td>
<td align="center"><span class="math inline">\(F(x_i, \beta) = 1 / (1 + \exp{(-a_0 - \beta x_i}))\)</span></td>
<td align="right">
<span class="math inline">\(a_0\)</span> fixed and a gamma prior on <span class="math inline">\(\beta\)</span>
</td>
</tr>
<tr class="even">
<td><code>stanmodels$CrmTwoParamLogisticNormalPrior</code></td>
<td align="center"><span class="math inline">\(F(x_i, \alpha, \beta) = 1 / (1 + \exp{(-\alpha - \beta x_i}))\)</span></td>
<td align="right">normal priors on <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>
</td>
</tr>
</tbody>
</table>
<!-- - `stanmodels$CrmEmpiricNormalPrior`, for the empiric model (aka the power model), $F(x_i, \beta)$ = $x_i^{\exp{\beta}}$, with normal prior on $\beta$; --><!-- - `stanmodels$CrmOneParamLogisticNormalPrior`, the one-parameter logistic model, $F(x_i, \beta) = 1 / (1 + \exp{(-a_0 - \beta x_i}))$, with $a_0$ fixed and a normal prior on $\beta$; --><!-- - `stanmodels$CrmOneParamLogisticGammaPrior`, the one-parameter logistic model, $F(x_i, \beta) = 1 / (1 + \exp{(-a_0 - \beta x_i}))$, with  $a_0$ fixed and a gamma prior on $\beta$; --><!-- - `stanmodels$CrmTwoParamLogisticNormalPrior`, the two-parameter logistic model, $F(x_i, \beta) = 1 / (1 + \exp{(-\alpha - \beta x_i}))$, with normal priors on $\alpha$ and $\beta$; --><p>Other variants could easily be added in future, if requested. For instance, <span class="citation">Cheung (2011)</span> defines a model that uses the hyperbolic tangent link function, but we have not implemented it here because we have never required it.</p>
<div id="usage" class="section level1">
<h1 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h1>
<p>Let’s conduct some examples. We must load <code>trialr</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(trialr)</code></pre></div>
<p>For illustration, we consider a scenario where we investigate 5 dose-levels seeking the dose with Pr(DLT) closest to 25%. We will assume that our <em>skeleton</em> (i.e. our prior belief of the dose-toxicity curve) is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">target &lt;-<span class="st"> </span><span class="fl">0.25</span>
skeleton &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.15</span>, <span class="fl">0.25</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>)</code></pre></div>
<p>Say that we have treated 6 patients at 3 dose-levels:</p>
<table class="table">
<thead><tr class="header">
<th align="center">Patient</th>
<th align="center">Cohort</th>
<th align="center">Dose-level</th>
<th align="center">DLT</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">doses_given &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>)
dlt &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>)</code></pre></div>
<p>We update each of our CRM models in this scenario. We then briefly compare the inferences at the end.</p>
<div id="empiric-model" class="section level2">
<h2 class="hasAnchor">
<a href="#empiric-model" class="anchor"></a>Empiric model</h2>
<p>We collect the data required by the Stan routine in a list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1 &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">a0 =</span> <span class="dv">3</span>,
  <span class="dt">beta_sd =</span> <span class="kw">sqrt</span>(<span class="fl">1.34</span>),
  <span class="dt">num_doses =</span> <span class="kw">length</span>(skeleton),
  <span class="dt">skeleton =</span> skeleton,
  <span class="dt">num_patients =</span> <span class="kw">length</span>(doses_given),
  <span class="dt">tox =</span> dlt,
  <span class="dt">doses =</span> doses_given
)
samp1 &lt;-<span class="st"> </span>rstan<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-sampling">sampling</a></span>(stanmodels<span class="op">$</span>CrmEmpiricNormalPrior,
                         <span class="dt">data =</span> dat1, <span class="dt">seed =</span> <span class="dv">123</span>)
<span class="co">#&gt; trying deprecated constructor; please alert package maintainer</span></code></pre></div>
<p>We use a fixed intercept value of 3 and a prior variance of <span class="math inline">\(\beta\)</span> equal to 1.34, as used in Cheung. In this demonstration, we set the seed when sampling for reproducibility but in the wild, you might not do this.</p>
<p>We extract the samples of the posterior probability of DLT at each dose, stored as the series of parameters called <code>prob_tox</code>. From there, all manner of inference is possible. We can, for example, calculate the posterior expected probability of DLT at each dose as the mean of each sample:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prob_tox_samp1 &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(samp1, <span class="st">'prob_tox'</span>)
prob_tox1 &lt;-<span class="st"> </span><span class="kw">colMeans</span>(prob_tox_samp1)
prob_tox1
<span class="co">#&gt; prob_tox[1] prob_tox[2] prob_tox[3] prob_tox[4] prob_tox[5] </span>
<span class="co">#&gt;   0.1081169   0.2159618   0.3098591   0.4444842   0.6235105</span></code></pre></div>
<p>We see that dose-level 2 is closest to our toxicity target of 25%. Having posterior samples is very liberating, for an inferential point of view. For example, it is trivial to calculate the probability that the toxicity rate exceeds the target DLT probability at each dose:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prob_too_toxic1 &lt;-<span class="st"> </span><span class="kw">unname</span>(<span class="kw">colMeans</span>(prob_tox_samp1 <span class="op">&gt;</span><span class="st"> </span>target))
prob_too_toxic1
<span class="co">#&gt; [1] 0.11700 0.35725 0.60075 0.86500 0.99150</span></code></pre></div>
<p>Even at this early stage, we are quite sure that the top dose is too toxic.</p>
</div>
<div id="one-parameter-logisitic-model-with-normal-prior" class="section level2">
<h2 class="hasAnchor">
<a href="#one-parameter-logisitic-model-with-normal-prior" class="anchor"></a>One parameter logisitic model with normal prior</h2>
<p>THis model takes similar parameters to those used before:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2 &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">a0 =</span> <span class="dv">3</span>,
  <span class="dt">beta_mean =</span> <span class="dv">0</span>,
  <span class="dt">beta_sd =</span> <span class="kw">sqrt</span>(<span class="fl">1.34</span>),
  <span class="dt">num_doses =</span> <span class="kw">length</span>(skeleton),
  <span class="dt">skeleton =</span> skeleton,
  <span class="dt">num_patients =</span> <span class="kw">length</span>(doses_given),
  <span class="dt">tox =</span> dlt,
  <span class="dt">doses =</span> doses_given
)</code></pre></div>
<p>We then fit the model to the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">samp2 &lt;-<span class="st"> </span>rstan<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-sampling">sampling</a></span>(stanmodels<span class="op">$</span>CrmOneParamLogisticNormalPrior,
                         <span class="dt">data =</span> dat2, <span class="dt">seed =</span> <span class="dv">123</span>)
<span class="co">#&gt; trying deprecated constructor; please alert package maintainer</span></code></pre></div>
<p>and perform some simple post-processing, as before:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prob_tox_samp2 &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(samp2, <span class="st">'prob_tox'</span>)
prob_tox2 &lt;-<span class="st"> </span><span class="kw">colMeans</span>(prob_tox_samp2)
prob_tox2
<span class="co">#&gt; prob_tox[1] prob_tox[2] prob_tox[3] prob_tox[4] prob_tox[5] </span>
<span class="co">#&gt;   0.1136138   0.2257824   0.3176084   0.4453331   0.6170505</span></code></pre></div>
</div>
<div id="one-parameter-logisitic-model-with-gamma-prior" class="section level2">
<h2 class="hasAnchor">
<a href="#one-parameter-logisitic-model-with-gamma-prior" class="anchor"></a>One parameter logisitic model with gamma prior</h2>
<p>This model requires slightly different parameters, on account of the gamma prior:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat3 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a0 =</span> <span class="dv">3</span>,
             <span class="dt">beta_shape =</span> <span class="dv">1</span>,
             <span class="dt">beta_inverse_scale =</span> <span class="dv">1</span>,
             <span class="dt">num_doses =</span> <span class="kw">length</span>(skeleton),
             <span class="dt">skeleton =</span> skeleton,
             <span class="dt">num_patients =</span> <span class="kw">length</span>(doses_given),
             <span class="dt">tox =</span> dlt,
             <span class="dt">doses =</span> doses_given
)</code></pre></div>
<p>This use of a Gamma(1, 1) prior is the same as an Exponential(1) prior.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">samp3 &lt;-<span class="st"> </span>rstan<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-sampling">sampling</a></span>(stanmodels<span class="op">$</span>CrmOneParamLogisticGammaPrior,
                         <span class="dt">data =</span> dat3, <span class="dt">seed =</span> <span class="dv">123</span>)
<span class="co">#&gt; trying deprecated constructor; please alert package maintainer</span>
<span class="co">#&gt; Warning: There were 1 divergent transitions after warmup. Increasing adapt_delta above 0.8 may help. See</span>
<span class="co">#&gt; http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
<span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prob_tox_samp3 &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(samp3, <span class="st">'prob_tox'</span>)
prob_tox3 &lt;-<span class="st"> </span><span class="kw">colMeans</span>(prob_tox_samp3)
prob_tox3
<span class="co">#&gt; prob_tox[1] prob_tox[2] prob_tox[3] prob_tox[4] prob_tox[5] </span>
<span class="co">#&gt;   0.1156100   0.2281370   0.3195988   0.4466272   0.6177018</span></code></pre></div>
</div>
<div id="two-parameter-logisitic-model-with-normal-priors" class="section level2">
<h2 class="hasAnchor">
<a href="#two-parameter-logisitic-model-with-normal-priors" class="anchor"></a>Two parameter logisitic model with normal priors</h2>
<p>TODO</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Cheung2011">
<p>Cheung, Ying Kuen. 2011. <em>Dose Finding by the Continual Reassessment Method</em>. New York: Chapman &amp; Hall / CRC Press.</p>
</div>
<div id="ref-OQuigley1990">
<p>O’Quigley, J, M Pepe, and L Fisher. 1990. “Continual reassessment method: a practical design for phase 1 clinical trials in cancer.” <em>Biometrics</em> 46 (1): 33–48. doi:<a href="https://doi.org/10.2307/2531628">10.2307/2531628</a>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#usage">Usage</a><ul class="nav nav-pills nav-stacked">
<li><a href="#empiric-model">Empiric model</a></li>
      <li><a href="#one-parameter-logisitic-model-with-normal-prior">One parameter logisitic model with normal prior</a></li>
      <li><a href="#one-parameter-logisitic-model-with-gamma-prior">One parameter logisitic model with gamma prior</a></li>
      <li><a href="#two-parameter-logisitic-model-with-normal-priors">Two parameter logisitic model with normal priors</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kristian Brock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
