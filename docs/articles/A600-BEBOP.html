<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BEBOP in PePS2 • trialr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="BEBOP in PePS2">
<meta property="og:description" content="trialr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trialr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/A200-CRM.html">Continual Reassessment Method</a>
    </li>
    <li>
      <a href="../articles/A210-CRM-visualisation.html">Visualisation with CRM</a>
    </li>
    <li>
      <a href="../articles/A220-CRM-pathways.html">Dose pathways with CRM</a>
    </li>
    <li>
      <a href="../articles/A250-LevyCaseStudy.html">CRM Case Study 1 - Levy et al (2006)</a>
    </li>
    <li>
      <a href="../articles/A260-TITE-CRM.html">Time-to-Event Continual Reassessment Method</a>
    </li>
    <li>
      <a href="../articles/A300-NeuenschwanderBransonGsponer.html">Two-parameter logistic model for dose-finding by Neuenschwander, Branson &amp; Gsponer</a>
    </li>
    <li>
      <a href="../articles/A400-EffTox.html">EffTox</a>
    </li>
    <li>
      <a href="../articles/A500-HierarchicalBayesianResponse.html">Hierarchical Bayesian Model for Binary Responses</a>
    </li>
    <li>
      <a href="../articles/A600-BEBOP.html">BEBOP in PePS2</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/brockk/trialr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>BEBOP in PePS2</h1>
                        <h4 class="author">Kristian Brock</h4>
            
            <h4 class="date">2020-10-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/brockk/trialr/blob/master/vignettes/A600-BEBOP.Rmd"><code>vignettes/A600-BEBOP.Rmd</code></a></small>
      <div class="hidden name"><code>A600-BEBOP.Rmd</code></div>

    </div>

    
    
<div id="introducing-the-bebop-design" class="section level1">
<h1 class="hasAnchor">
<a href="#introducing-the-bebop-design" class="anchor"></a>Introducing the BEBOP design</h1>
<p>The BEBOP phase II trial methodology incorporates predictive baseline information to study co-primary efficacy and toxicity outcomes. BEBOP stands for Bayesian Evaluation of Bivariate Binary Outcomes and Predictive Information. It was developed for the PePS2 trial, investigating pembrolizumab in non-small-cell lung cancer (NSCLC) patients with performance status 2 (PS2). A major factor in the PePS2 trial is the data on PS0 / 1 NSCLC patients published by <span class="citation">Garon et al. (2015)</span>, showing that patients with greater PD-L1 tumour proportion scores are more likely to achieve an objective response. They introduce this predictive biomarker and validate a three-level categorisation Low, Medium and High PD-L1 score. There was also a suggestion (albeit not shown to be <em>statistically significant</em>) that previously untreated patients are more likely to have a response. These same variables will likely be predictive of response in the PS2 population. Brock et al. (publication in submission) developed BEBOP to make efficient use of this information.</p>
<p>BEBOP re-uses the probability model at the core of the EffTox design <span class="citation">(Thall and Cook 2004; Thall et al. 2014)</span>. Let <span class="math inline">\(x\)</span> represent a vector of predictive baseline variables and <span class="math inline">\(\boldsymbol{\theta}\)</span> a vector of parameters. The marginal probabilities of efficacy and toxicity are estimated using general functions <span class="math inline">\(\text{logit } \pi_E(x, \boldsymbol{\theta})\)</span> and <span class="math inline">\(\text{logit } \pi_T(x, \boldsymbol{\theta})\)</span> to be specified by the user.</p>
<p>In PePS2, we have <span class="math inline">\(x_{i1} = 1\)</span> if a patient has been previously treated. To convey PD-L1 expression, the authors use <span class="math inline">\(x_{i2} = 1\)</span> and <span class="math inline">\(x_{i3} = 0\)</span> if a patient has a Low PD-L1 score; <span class="math inline">\(x_{i2} = 0\)</span> and <span class="math inline">\(x_{i3} = 1\)</span> if a patient has a Medium PD-L1 score; and <span class="math inline">\(x_{i2} = 0\)</span> and <span class="math inline">\(x_{i3} = 0\)</span> if a patient has a High PD-L1 score. Thus, we have <span class="math inline">\(x_i = (x_{i1}, x_{i2}, x_{i3})\)</span>. The marginal efficacy and toxicity functions in PePS2 take the form</p>
<p><span class="math inline">\(\text{logit } \pi_E(x, \boldsymbol{\theta}) = \alpha + \beta x_{i1} + \gamma x_{i2} + \zeta x_{i3}\)</span></p>
<p><span class="math inline">\(\text{logit } \pi_T(x, \boldsymbol{\theta}) = \lambda\)</span></p>
<p>As with EffTox, let <span class="math inline">\((Y_j, Z_j)\)</span> be random variables each taking values <span class="math inline">\(\{0, 1\}\)</span> respresenting the presence of efficacy and toxicity in patient <span class="math inline">\(j\)</span>. The efficacy and toxicity events are associated by the joint probability function</p>
<p><span class="math inline">\(Pr(Y = a, Z = b) = \pi_{a,b}(\pi_E, \pi_T) = (\pi_E)^a (1-\pi_E)^{1-a} (\pi_T)^b (1-\pi_T)^{1-b} + (-1)^{a+b} (\pi_E) (1-\pi_E) (\pi_T) (1-\pi_T) \frac{e^\psi-1}{e^\psi+1}\)</span>.</p>
<p>The complete vector of parameters is <span class="math inline">\(\boldsymbol{\theta} = (\alpha, \beta, \gamma, \zeta, \lambda, \psi)\)</span>. Normal priors are specified for the elements of <span class="math inline">\(\boldsymbol{\theta}\)</span>.</p>
<p>The treatment is acceptable for patients with predictive vector <span class="math inline">\(x\)</span> if</p>
<p><span class="math inline">\(\text{Pr}\left\{ \pi_E(x, \boldsymbol{\theta}) &gt; \underline{\pi}_E | \mathcal{D} \right\} &gt; p_E\)</span></p>
<p>and</p>
<p><span class="math inline">\(\text{Pr}\left\{ \pi_T(x, \boldsymbol{\theta}) &lt; \overline{\pi}_T | \mathcal{D} \right\} &gt; p_T\)</span></p>
<p>where <span class="math inline">\(\underline{\pi}_E, \overline{\pi}_T, p_E, p_T\)</span> are chosen for clinical relevance.</p>
<p>PePS2 is an all-comers trial, thus patients are admitted regardless of their PD-L1 or pre-treatment status. This is motivated by the dearth of treatment options for PS2 NSCLC patients who cannot use chemotherapy. The design allows the predictive information to effectively stratify the analysis without stratifying recruitment. The statistical design uses the common Bayesian tool of borrowing strength across groups to improve the performance of the analysis.</p>
</div>
<div id="peps2-scenario-in-trialr" class="section level1">
<h1 class="hasAnchor">
<a href="#peps2-scenario-in-trialr" class="anchor"></a>PePS2 Scenario in <code>trialr</code>
</h1>
<p>The cohorts in the PePS2 trial are</p>
<table class="table">
<thead><tr class="header">
<th align="right">i</th>
<th align="left">Pretreated</th>
<th align="left">PDL1</th>
<th align="right">x1</th>
<th align="right">x2</th>
<th align="right">x3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="left">Low</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">FALSE</td>
<td align="left">Medium</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">FALSE</td>
<td align="left">High</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">TRUE</td>
<td align="left">Low</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">TRUE</td>
<td align="left">Medium</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">TRUE</td>
<td align="left">High</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The trial uses a sample size of 60. Let us simulate a set of outcomes with the following efficacy and toxicity rates</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">trialr</span>)
<span class="no">peps2_sc</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() <span class="fu"><a href="../reference/peps2_get_data.html">peps2_get_data</a></span>(<span class="kw">num_patients</span> <span class="kw">=</span> <span class="fl">60</span>,
                                      <span class="kw">prob_eff</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.167</span>, <span class="fl">0.192</span>, <span class="fl">0.5</span>, <span class="fl">0.091</span>, <span class="fl">0.156</span>, <span class="fl">0.439</span>),
                                      <span class="kw">prob_tox</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.1</span>, <span class="fl">6</span>),
                                      <span class="kw">eff_tox_or</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>, <span class="fl">6</span>))

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">123</span>)
<span class="no">dat</span> <span class="kw">&lt;-</span> <span class="fu">peps2_sc</span>()</pre></body></html></div>
<p>In this example, we have used efficacy rates that increase in PD-L1 and are slightly higher in previously-uintreated patients. We use the uniform toxicity rate of 10% across all cohorts, and no association between efficacy and toxicity events, represented by odds-ratios equal to 1.</p>
<p>The <code>dat</code> object contains, for example, the prior parameters</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">dat</span>$<span class="no">alpha_mean</span>, <span class="no">dat</span>$<span class="no">alpha_sd</span>)</pre></body></html></div>
<pre><code>## [1] -2.2  2.0</code></pre>
<p>and simulated predictive variables and efficacy and toxicity outcomes</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">dat</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">eff</span>, <span class="no">tox</span>, <span class="no">x1</span>, <span class="no">x2</span>, <span class="no">x3</span>)), <span class="fl">10</span>)
)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">eff</th>
<th align="right">tox</th>
<th align="right">x1</th>
<th align="right">x2</th>
<th align="right">x3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>We fit the data to the BEBOP model and obtain samples from the posterior distribution using <code>rstan</code>. The <code>BebopInPeps2</code> model is provided by <code>trialr</code> and compiled when the package is installed.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stan_peps2.html">stan_peps2</a></span>(<span class="no">dat</span>$<span class="no">eff</span>, <span class="no">dat</span>$<span class="no">tox</span>, <span class="no">dat</span>$<span class="no">cohorts</span>)</pre></body></html></div>
<p>It is informative to view plots of posterior beliefs. Posterior samples of parameter values are available but they are less meaningful to us than the modelled efficacy rates, for example. View posterior distributions using code like</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="kw pkg">rstan</span><span class="kw ns">::</span><span class="fu">plot</span>(<span class="no">fit</span>, <span class="kw">pars</span> <span class="kw">=</span> <span class="st">'prob_eff'</span>)</pre></body></html></div>
<div class="figure">
<img src="A600-BEBOP_files/figure-html/unnamed-chunk-6-1.png" alt="Posterior Prob(Efficacy) in the six PePS2 cohorts" width="672"><p class="caption">
Posterior Prob(Efficacy) in the six PePS2 cohorts
</p>
</div>
<p>We see that the modelled rates of efficacy are highest in cohorts 3 and 6, but likely to be greater than the critical threshold of 10% in cohort 2 and perhaps cohort 5 as well. In contrast, there is not much evidence of clinical benefit in cohorts 1 and 4. This is confirmed by invoking the formally described analysis and associated decision rules.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">decision</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/peps2_process.html">peps2_process</a></span>(<span class="no">fit</span>)
<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">decision</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">ProbEff</span>, <span class="no">ProbAccEff</span>, <span class="no">ProbTox</span>, <span class="no">ProbAccTox</span>, <span class="no">Accept</span>)),
  <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">3</span>
)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ProbEff</th>
<th align="right">ProbAccEff</th>
<th align="right">ProbTox</th>
<th align="right">ProbAccTox</th>
<th align="left">Accept</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.073</td>
<td align="right">0.254</td>
<td align="right">0.068</td>
<td align="right">1</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">0.249</td>
<td align="right">0.979</td>
<td align="right">0.068</td>
<td align="right">1</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">0.424</td>
<td align="right">0.992</td>
<td align="right">0.068</td>
<td align="right">1</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">0.040</td>
<td align="right">0.093</td>
<td align="right">0.068</td>
<td align="right">1</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">0.150</td>
<td align="right">0.742</td>
<td align="right">0.068</td>
<td align="right">1</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">0.282</td>
<td align="right">0.948</td>
<td align="right">0.068</td>
<td align="right">1</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
<p>ProbAccEff is the posterior probability that the efficacy rate in a cohort is greater than the 10% threshold. ProbAccTox is the probability that toxicity is less than 30%. The treatment is acceptable in a cohort if it is sufficiently efficacious and non-toxic. We see that in this simulated iteration, the treatment would be approved in all cohorts except 1 and 4.</p>
<p>We can perform the simulations on a greater number of iterations to learn about the operating characteristics of the design.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">123</span>)
<span class="no">run_sims</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">num_sims</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="no">sample_data_func</span> <span class="kw">=</span> <span class="no">peps2_sc</span>,
                     <span class="no">summarise_func</span> <span class="kw">=</span> <span class="no">peps2_process</span>, <span class="no">...</span>) {
  <span class="no">sims</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
  <span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">num_sims</span>) {
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">i</span>)
    <span class="no">dat</span> <span class="kw">&lt;-</span> <span class="fu">sample_data_func</span>()
    <span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stan_peps2.html">stan_peps2</a></span>(<span class="no">dat</span>$<span class="no">eff</span>, <span class="no">dat</span>$<span class="no">tox</span>, <span class="no">dat</span>$<span class="no">cohorts</span>, <span class="no">...</span>)
    <span class="no">sim</span> <span class="kw">&lt;-</span> <span class="fu">summarise_func</span>(<span class="no">fit</span>)
    <span class="no">sims</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="no">sim</span>
  }
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">sims</span>)
}

<span class="no">sims</span> <span class="kw">&lt;-</span> <span class="fu">run_sims</span>(<span class="kw">num_sims</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">sample_data_func</span> <span class="kw">=</span> <span class="no">peps2_sc</span>,
                 <span class="kw">summarise_func</span> <span class="kw">=</span> <span class="no">peps2_process</span>)</pre></body></html></div>
<p>In <code>run_sims</code>, the second and third args are delegates to simulate trial outcomes and post-process the <code>rstan</code> sample respectively. The outcome samping delelgate is called without arguments. The post-process delegate is called with first argument the object returned by the outcome sampling delegate (e.g. <code>dat</code> above), and second argument the posterior sample from <code>rstan</code> (e.g. <code>samp</code> above). The objects returned by the post-process delegate form the items in the <code>sims</code> object that are returned to the user by <code>peps2_run_sims</code>.</p>
<p>Thus, the probaility of approving the treatment using the statistical design in this scenario can be calculated using</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">sims</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>$<span class="no">Accept</span>), <span class="fl">1</span>, <span class="no">mean</span>)</pre></body></html></div>
</div>
<div id="trialr" class="section level1">
<h1 class="hasAnchor">
<a href="#trialr" class="anchor"></a>trialr</h1>
<p><code>trialr</code> is available at <a href="https://github.com/brockk/trialr" class="uri">https://github.com/brockk/trialr</a> and <a href="https://CRAN.R-project.org/package=trialr" class="uri">https://CRAN.R-project.org/package=trialr</a></p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Garon2015">
<p>Garon, Edward B, Naiyer a Rizvi, Rina Hui, Natasha Leighl, Ani S Balmanoukian, Joseph Paul Eder, Amita Patnaik, et al. 2015. “Pembrolizumab for the Treatment of Non-Small-Cell Lung Cancer.” <em>The New England Journal of Medicine</em> 372 (21): 2018–28. <a href="https://doi.org/10.1056/NEJMoa1501824">https://doi.org/10.1056/NEJMoa1501824</a>.</p>
</div>
<div id="ref-Thall2004">
<p>Thall, PF, and JD Cook. 2004. “Dose-Finding Based on Efficacy-Toxicity Trade-Offs.” <em>Biometrics</em> 60 (3): 684–93.</p>
</div>
<div id="ref-Thall2014">
<p>Thall, PF, RC Herrick, HQ Nguyen, JJ Venier, and JC Norris. 2014. “Effective Sample Size for Computing Prior Hyperparameters in Bayesian Phase I-II Dose-Finding.” <em>Clinical Trials</em> 11 (6): 657–66. <a href="https://doi.org/10.1177/1740774514547397">https://doi.org/10.1177/1740774514547397</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kristian Brock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
