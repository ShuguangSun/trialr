<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overview of trialr • trialr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Overview of trialr">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trialr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/BEBOP.html">BEBOP in PePS2</a>
    </li>
    <li>
      <a href="../articles/CRM-visualisation.html">Visualisation with CRM</a>
    </li>
    <li>
      <a href="../articles/CRM.html">Continual Reassessment Method</a>
    </li>
    <li>
      <a href="../articles/EffTox.html">EffTox in trialr</a>
    </li>
    <li>
      <a href="../articles/HierarchicalBayesianResponse.html">Hierarchical Bayesian Model for Binary Responses</a>
    </li>
    <li>
      <a href="../articles/trialr-overview.html">Overview of trialr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/brockk/trialr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Overview of trialr</h1>
                        <h4 class="author">Kristian Brock</h4>
            
            <h4 class="date">2019-04-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/brockk/trialr/blob/master/vignettes/trialr-overview.Rmd"><code>vignettes/trialr-overview.Rmd</code></a></small>
      <div class="hidden name"><code>trialr-overview.Rmd</code></div>

    </div>

    
    
<p><code>trialr</code> is a collection of Bayesian clinical trial designs implemented in Stan and R.</p>
<p>Many Bayesian experimental designs for clinical trials have been published. However, one of the factors that has constrained their adoption is availability of software. We present here some of the most notable, implemented and demonstrated in a consistent style, leveraging the powerful Stan environment.</p>
<p>Often authors of trial designs make available code with their publication. There are also some fantastic packages that aid the use of certain designs. However, challenges to use still persist. The disparate methods are naturally presented in a style that appeals to the particular author. Features implemented in one package for one design may be missing in another. Sometimes the technology chosen may only be available on one particular operating system, or the chosen technology may have fallen into disuse.</p>
<p><code>trialr</code> seeks to address these problems. Models are specified in <a href="http://mc-stan.org/">Stan</a>, a state-of-the-art environment for Bayesian analysis. It uses Hamiltonian Monte Carlo to take samples from the posterior distribution. This method is more efficient than Gibbs sampling, for instance, and reliable inference can generally be performed on a few thousand posterior samples. R, Stan and <code>trialr</code> are each available on Mac, Linux, and Windows, so all of the examples presented here should work on each operating system. Furthermore, Stan offers a very simple method to split the sampling across <em>n</em> cores, taking advantage of modern multicore processors.</p>
<p>The designs implemented in <code>trialr</code> are introduced briefly below, and developed more fully in vignettes. We focus on practical usage, including:</p>
<ul>
<li>fitting models to observed data using your prior;</li>
<li>processing posterior samples to produce useful inferences;</li>
<li>and visualising inferences using modern <code>ggplot</code> graphics.</li>
</ul>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h1>
<p>In all examples, we will need to load <code>trialr</code></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(trialr)</a></code></pre></div>
<div id="crm" class="section level2">
<h2 class="hasAnchor">
<a href="#crm" class="anchor"></a>CRM</h2>
<p>The Continual Reassessment Method (CRM) was first published by O’Quigley <em>et al.</em> (1990). It assumes a smooth mathematical form for the dose-toxicity curve to conduct a dose-finding trial seeking a maximum tolerable dose. There are many variations to suit different clinical scenarios and the design has enjoyed relatively common use (although nowhere near as common as the ubiquitous and inferior 3+3 design).</p>
<p>We will demonstrate the method using a notional trial example. In a scenario of five potential doses, let us assume that we seek the dose with probability of toxicity closest to 25% where our prior guesses of the rates of toxicity can be represented:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">target &lt;-<span class="st"> </span><span class="fl">0.25</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">skeleton &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.15</span>, <span class="fl">0.25</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>)</a></code></pre></div>
<p>Let us assume that we have already treated 2 patients each at doses 2, 3 and 4, having only seen toxicity at dose-level 4. What dose should we give to the next patient or cohort? We can fit the data to the popular <em>empiric</em> model:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">mod1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stan_crm.html">stan_crm</a></span>(<span class="dt">outcome_str =</span> <span class="st">'2NN 3NN 4TT'</span>, <span class="dt">skeleton =</span> skeleton, </a>
<a class="sourceLine" id="cb3-2" data-line-number="2">                 <span class="dt">target =</span> target, <span class="dt">model =</span> <span class="st">'empiric'</span>, <span class="dt">beta_sd =</span> <span class="kw">sqrt</span>(<span class="fl">1.34</span>), </a>
<a class="sourceLine" id="cb3-3" data-line-number="3">                 <span class="dt">seed =</span> <span class="dv">123</span>)</a></code></pre></div>
<p>The fitted model contains lots of useful of information:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">mod1</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt;   Patient Dose Toxicity Weight</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; 1       1    2        0      1</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt; 2       2    2        0      1</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; 3       3    3        0      1</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; 4       4    3        0      1</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; 5       5    4        1      1</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; 6       6    4        1      1</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;   DoseLevel Skeleton N Tox ProbTox MedianProbTox ProbMTD</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; 1         1     0.05 0   0   0.108        0.0726  0.2140</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; 2         2     0.15 2   0   0.216        0.1900  0.2717</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; 3         3     0.25 2   0   0.310        0.2972  0.2657</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; 4         4     0.40 2   2   0.444        0.4484  0.2090</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; 5         5     0.60 0   0   0.624        0.6395  0.0395</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; The model targets a toxicity level of 0.25.</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; The dose with estimated toxicity probability closest to target is 2.</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; The dose most likely to be the MTD is 2.</span></a></code></pre></div>
<p>We see that dose-level 2 is the dose that the model recommends to be given to the next cohort.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">mod1<span class="op">$</span>recommended_dose</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
<p>All manner of interested visualisation is facilitated by the MCMC samples. The following plot simply shows the posterior expected probability of toxicity at each dose.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">plot_df =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">DoseLevel =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(skeleton),</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">                     <span class="dt">ProbTox =</span> mod1<span class="op">$</span>prob_tox)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(plot_df, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> DoseLevel, <span class="dt">y =</span> ProbTox)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/lims">ylim</a></span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_abline">geom_hline</a></span>(<span class="dt">yintercept =</span> target, <span class="dt">col =</span> <span class="st">'orange'</span>, <span class="dt">linetype =</span> <span class="st">'dashed'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">title =</span> <span class="st">'Posterior dose-toxicity curve under empiric CRM model'</span>)</a></code></pre></div>
<p><img src="trialr-overview_files/figure-html/unnamed-chunk-6-1.png" width="672"> Confirmation that dose-level 2 is predicted to be closest to the target toxicity rate, although dose 3 is also close.</p>
<p>Several variants of the CRM <a href="https://brockk.github.io/trialr/articles/CRM.html">are implemented in ‘trialr’</a>. Further visualisation techniques are demonstrated in the <a href="https://brockk.github.io/trialr/articles/CRM-visualisation.html">Visualisation in CRM</a> vignette.</p>
</div>
<div id="efftox" class="section level2">
<h2 class="hasAnchor">
<a href="#efftox" class="anchor"></a>EffTox</h2>
<p>EffTox by Thall &amp; Cook (2004) is a dose-finding design that uses binary efficacy and toxicity outcomes to select a dose with a high utility score. We present it briefly here but there is a much more thorough examination in the <a href="https://brockk.github.io/trialr/articles/EffTox.html">EffTox vignette</a>.</p>
<p>For demonstration, we fit the model parameterisation introduced by Thall <em>et al.</em> (2014) to the following notional outcomes:</p>
<table class="table">
<thead><tr class="header">
<th align="center">Patient</th>
<th align="center">Dose-level</th>
<th align="center">Toxicity</th>
<th align="center">Efficacy</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">outcomes &lt;-<span class="st"> '1NNE 2EEB'</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">mod2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stan_efftox_demo.html">stan_efftox_demo</a></span>(outcomes, <span class="dt">seed =</span> <span class="dv">123</span>)</a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">mod2</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt;   Patient Dose Toxicity Efficacy</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; 1       1    1        0        0</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; 2       2    1        0        0</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; 3       3    1        0        1</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; 4       4    2        0        1</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; 5       5    2        0        1</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt; 6       6    2        1        1</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt;   DoseLevel   ProbEff    ProbTox ProbAccEff ProbAccTox    Utility</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; 1         1 0.4045039 0.08990953    0.33175    0.92700 -0.3397885</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; 2         2 0.7917219 0.09875146    0.94575    0.92250  0.4237935</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt; 3         3 0.9313427 0.21522248    0.98475    0.72900  0.5249445</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; 4         4 0.9572788 0.30606939    0.98475    0.62925  0.4380717</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; 5         5 0.9657038 0.36255571    0.98350    0.57725  0.3685257</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt;   Acceptable</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt; 1       TRUE</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt; 2       TRUE</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt; 3       TRUE</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="co">#&gt; 4      FALSE</span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21"><span class="co">#&gt; 5      FALSE</span></a>
<a class="sourceLine" id="cb8-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="co">#&gt; The model recommends selecting dose-level 3.</span></a></code></pre></div>
<p>In this instance, after evaluation of our six patients, the dose advocated for the next group is dose-level 3. This is contained in the fitted object:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">mod2<span class="op">$</span>recommended_dose</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt; [1] 3</span></a></code></pre></div>
<p>This is not surprising because dose 3 has the highest utility score:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">mod2<span class="op">$</span>utility</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt; [1] -0.3397885  0.4237935  0.5249445  0.4380717  0.3685257</span></a></code></pre></div>
<p>Sometimes, doses other than the maximal-utility dose will be recommended because of the dose-admissibility rules. See the papers or the <a href="https://brockk.github.io/trialr/articles/EffTox.html">EffTox vignette</a> for more details.</p>
<p>Functions are provided to create useful plots. For instance, it is illuminating to plot the posterior means of the probabilities of efficacy and toxicity at each of the doses on the trade-off contours. The five doses are shown in red. Doses closer to the lower-right corner have higher utility.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="../reference/efftox_contour_plot.html">efftox_contour_plot</a></span>(mod2<span class="op">$</span>dat, <span class="dt">prob_eff =</span> mod2<span class="op">$</span>prob_eff, <span class="dt">prob_tox =</span> mod2<span class="op">$</span>prob_tox)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw">title</span>(<span class="st">'EffTox utility contours'</span>)</a></code></pre></div>
<p><img src="trialr-overview_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>This example continues in the <a href="https://brockk.github.io/trialr/articles/EffTox.html">EffTox vignette</a>.</p>
<p>There are many publications related to EffTox but the two most important are <span class="citation">Thall and Cook (2004)</span> and <span class="citation">Thall et al. (2014)</span>.</p>
</div>
<div id="hierachical-analysis-of-response-in-related-cohorts" class="section level2">
<h2 class="hasAnchor">
<a href="#hierachical-analysis-of-response-in-related-cohorts" class="anchor"></a>Hierachical analysis of response in related cohorts</h2>
<p>Sticking with Peter Thall’s huge contribution to Bayesian clinical trials, <span class="citation">Thall et al. (2003)</span> described a method for analysing treatment effects of a single intervention in several sub-types of a single disease. The method uses a simple hierarchical model with binary response variable and population-level and group-level intercepts.</p>
<p>They demonstrate the method for partially-pooling response rates to a single drug in various subtypes of sarcoma. We pass to Stan the sizes of the subgroups and the number of responses seen in each group. We also provide prior hyperparameters. Reproducing their example:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">mod3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stan_hierarchical_response_thall.html">stan_hierarchical_response_thall</a></span>(</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  <span class="dt">group_responses =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="dt">group_sizes =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span> ,<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  <span class="dt">mu_mean =</span> <span class="fl">-1.3863</span>,</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">  <span class="dt">mu_sd =</span> <span class="kw">sqrt</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="fl">0.1</span>),</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">  <span class="dt">tau_alpha =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">  <span class="dt">tau_beta =</span> <span class="dv">20</span>)</a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">mod3</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co">#&gt; Inference for Stan model: ThallHierarchicalBinary.</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="co">#&gt; 4 chains, each with iter=2000; warmup=1000; thin=1; </span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">#&gt; post-warmup draws per chain=1000, total post-warmup draws=4000.</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co">#&gt;                     mean se_mean    sd   2.5%    25%    50%    75%  97.5%</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt; mu                 -0.01    0.03  1.43  -2.91  -0.90   0.00   0.89   2.82</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#&gt; sigma2             13.10    0.49 15.68   3.43   6.45   9.47  14.92  43.96</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">#&gt; rho[1]              0.06    0.07  3.91  -7.61  -2.23   0.08   2.42   7.67</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt; rho[2]             -3.09    0.07  2.82  -9.71  -4.35  -2.54  -1.22   0.73</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co">#&gt; rho[3]              2.39    0.06  2.77  -1.79   0.56   1.95   3.75   8.98</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co">#&gt; rho[4]             -0.28    0.01  0.79  -1.89  -0.79  -0.25   0.25   1.25</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#&gt; rho[5]              3.74    0.06  2.37   0.59   2.16   3.26   4.84   9.86</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">#&gt; rho[6]              0.03    0.07  3.98  -8.03  -2.26   0.09   2.35   7.94</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co">#&gt; rho[7]              0.00    0.02  1.55  -3.20  -0.94   0.00   0.98   3.06</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co">#&gt; rho[8]              0.80    0.02  1.33  -1.65  -0.08   0.72   1.58   3.48</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">#&gt; rho[9]             -2.46    0.07  3.02  -9.22  -3.83  -1.98  -0.54   2.03</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18"><span class="co">#&gt; rho[10]             0.09    0.07  3.88  -7.74  -2.19   0.09   2.42   8.04</span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"><span class="co">#&gt; sigma               3.38    0.04  1.31   1.85   2.54   3.08   3.86   6.63</span></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="co">#&gt; prob_response[1]    0.51    0.01  0.38   0.00   0.10   0.52   0.92   1.00</span></a>
<a class="sourceLine" id="cb13-21" data-line-number="21"><span class="co">#&gt; prob_response[2]    0.15    0.00  0.19   0.00   0.01   0.07   0.23   0.67</span></a>
<a class="sourceLine" id="cb13-22" data-line-number="22"><span class="co">#&gt; prob_response[3]    0.77    0.00  0.25   0.14   0.64   0.88   0.98   1.00</span></a>
<a class="sourceLine" id="cb13-23" data-line-number="23"><span class="co">#&gt; prob_response[4]    0.44    0.00  0.17   0.13   0.31   0.44   0.56   0.78</span></a>
<a class="sourceLine" id="cb13-24" data-line-number="24"><span class="co">#&gt; prob_response[5]    0.92    0.00  0.10   0.64   0.90   0.96   0.99   1.00</span></a>
<a class="sourceLine" id="cb13-25" data-line-number="25"><span class="co">#&gt; prob_response[6]    0.51    0.01  0.38   0.00   0.09   0.52   0.91   1.00</span></a>
<a class="sourceLine" id="cb13-26" data-line-number="26"><span class="co">#&gt; prob_response[7]    0.50    0.00  0.27   0.04   0.28   0.50   0.73   0.96</span></a>
<a class="sourceLine" id="cb13-27" data-line-number="27"><span class="co">#&gt; prob_response[8]    0.64    0.00  0.23   0.16   0.48   0.67   0.83   0.97</span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28"><span class="co">#&gt; prob_response[9]    0.23    0.00  0.26   0.00   0.02   0.12   0.37   0.88</span></a>
<a class="sourceLine" id="cb13-29" data-line-number="29"><span class="co">#&gt; prob_response[10]   0.51    0.01  0.38   0.00   0.10   0.52   0.92   1.00</span></a>
<a class="sourceLine" id="cb13-30" data-line-number="30"><span class="co">#&gt; lp__              -34.55    0.14  3.79 -43.64 -36.61 -34.01 -31.81 -28.83</span></a>
<a class="sourceLine" id="cb13-31" data-line-number="31"><span class="co">#&gt;                   n_eff Rhat</span></a>
<a class="sourceLine" id="cb13-32" data-line-number="32"><span class="co">#&gt; mu                 2598    1</span></a>
<a class="sourceLine" id="cb13-33" data-line-number="33"><span class="co">#&gt; sigma2             1030    1</span></a>
<a class="sourceLine" id="cb13-34" data-line-number="34"><span class="co">#&gt; rho[1]             3157    1</span></a>
<a class="sourceLine" id="cb13-35" data-line-number="35"><span class="co">#&gt; rho[2]             1741    1</span></a>
<a class="sourceLine" id="cb13-36" data-line-number="36"><span class="co">#&gt; rho[3]             2029    1</span></a>
<a class="sourceLine" id="cb13-37" data-line-number="37"><span class="co">#&gt; rho[4]             4119    1</span></a>
<a class="sourceLine" id="cb13-38" data-line-number="38"><span class="co">#&gt; rho[5]             1355    1</span></a>
<a class="sourceLine" id="cb13-39" data-line-number="39"><span class="co">#&gt; rho[6]             3067    1</span></a>
<a class="sourceLine" id="cb13-40" data-line-number="40"><span class="co">#&gt; rho[7]             3961    1</span></a>
<a class="sourceLine" id="cb13-41" data-line-number="41"><span class="co">#&gt; rho[8]             3459    1</span></a>
<a class="sourceLine" id="cb13-42" data-line-number="42"><span class="co">#&gt; rho[9]             1825    1</span></a>
<a class="sourceLine" id="cb13-43" data-line-number="43"><span class="co">#&gt; rho[10]            3127    1</span></a>
<a class="sourceLine" id="cb13-44" data-line-number="44"><span class="co">#&gt; sigma               885    1</span></a>
<a class="sourceLine" id="cb13-45" data-line-number="45"><span class="co">#&gt; prob_response[1]   3914    1</span></a>
<a class="sourceLine" id="cb13-46" data-line-number="46"><span class="co">#&gt; prob_response[2]   4726    1</span></a>
<a class="sourceLine" id="cb13-47" data-line-number="47"><span class="co">#&gt; prob_response[3]   4348    1</span></a>
<a class="sourceLine" id="cb13-48" data-line-number="48"><span class="co">#&gt; prob_response[4]   4197    1</span></a>
<a class="sourceLine" id="cb13-49" data-line-number="49"><span class="co">#&gt; prob_response[5]   4334    1</span></a>
<a class="sourceLine" id="cb13-50" data-line-number="50"><span class="co">#&gt; prob_response[6]   3590    1</span></a>
<a class="sourceLine" id="cb13-51" data-line-number="51"><span class="co">#&gt; prob_response[7]   4227    1</span></a>
<a class="sourceLine" id="cb13-52" data-line-number="52"><span class="co">#&gt; prob_response[8]   4342    1</span></a>
<a class="sourceLine" id="cb13-53" data-line-number="53"><span class="co">#&gt; prob_response[9]   4373    1</span></a>
<a class="sourceLine" id="cb13-54" data-line-number="54"><span class="co">#&gt; prob_response[10]  4003    1</span></a>
<a class="sourceLine" id="cb13-55" data-line-number="55"><span class="co">#&gt; lp__                775    1</span></a>
<a class="sourceLine" id="cb13-56" data-line-number="56"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-57" data-line-number="57"><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Sun Apr 14 09:43:56 2019.</span></a>
<a class="sourceLine" id="cb13-58" data-line-number="58"><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></a>
<a class="sourceLine" id="cb13-59" data-line-number="59"><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></a>
<a class="sourceLine" id="cb13-60" data-line-number="60"><span class="co">#&gt; convergence, Rhat=1).</span></a></code></pre></div>
<p>We may visualise these inferences on the partially-pooled response rates in the subgroups:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">rstan<span class="op">::</span><span class="kw">plot</span>(mod3, <span class="dt">pars =</span> <span class="st">'prob_response'</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_abline">geom_vline</a></span>(<span class="dt">xintercept =</span> <span class="fl">0.3</span>, <span class="dt">col =</span> <span class="st">'orange'</span>, <span class="dt">linetype =</span> <span class="st">'dashed'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">title =</span> <span class="st">'Partially-pooled analysis of response rate in 10 sarcoma subtypes'</span>)</a></code></pre></div>
<p><img src="trialr-overview_files/figure-html/unnamed-chunk-14-1.png" width="672"> By default, plot methods are passed onwards to <code>rstan</code>.</p>
<p>The hierarchical model for binary responses is developed in <a href="https://brockk.github.io/trialr/articles/HierarchicalBayesianResponse.html">its own vignette</a>.</p>
</div>
<div id="bebop-in-peps2" class="section level2">
<h2 class="hasAnchor">
<a href="#bebop-in-peps2" class="anchor"></a>BEBOP in PePS2</h2>
<p><span class="citation">Thall, Nguyen, and Estey (2008)</span> introduced an extension of EffTox that allows dose-finding by efficacy and toxicity outcomes and adjusts for covariate information. Brock, et al. simplified the method by removing the dose-finding components to leave a design that studies associated co-primary and toxicity outcomes in an arbitrary number of cohorts determined by the basline covariates. They originally refered to the simplifed design as BEBOP, for <em>Bayesian Evaluation of Bivariate binary Outcomes with Predictive variables</em>. This name was later changed to P2TNE for <em>Phase 2 Thall, Nguyen &amp; Estey</em> to reflect its pedigree.</p>
<p>The design was implemented in a phase II trial of pembrolizumab in non-small-cell lung cancer called PePS2. A distinct feature of the trial is the availability of predictive baseline covariates, the most notwworthy of which is the PD-L1 tumour proportion score, shown by <span class="citation">Garon et al. (2015)</span> to be a predictive biomarker.</p>
<p>This example is demonstrated in the <a href="https://brockk.github.io/trialr/articles/BEBOP.html">BEBOP vignette</a>.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Garon2015">
<p>Garon, Edward B, Naiyer a Rizvi, Rina Hui, Natasha Leighl, Ani S Balmanoukian, Joseph Paul Eder, Amita Patnaik, et al. 2015. “Pembrolizumab for the treatment of non-small-cell lung cancer.” <em>The New England Journal of Medicine</em> 372 (21): 2018–28. <a href="https://doi.org/10.1056/NEJMoa1501824">https://doi.org/10.1056/NEJMoa1501824</a>.</p>
</div>
<div id="ref-Thall2008">
<p>Thall, Peter F., Hoang Q. Nguyen, and Elihu H. Estey. 2008. “Patient-specific dose finding based on bivariate outcomes and covariates.” <em>Biometrics</em> 64 (4): 1126–36. <a href="https://doi.org/10.1111/j.1541-0420.2008.01009.x">https://doi.org/10.1111/j.1541-0420.2008.01009.x</a>.</p>
</div>
<div id="ref-Thall2003">
<p>Thall, Peter F., J. Kyle Wathen, B. Nebiyou Bekele, Richard E. Champlin, Laurence H. Baker, and Robert S. Benjamin. 2003. “Hierarchical Bayesian approaches to phase II trials in diseases with multiple subtypes.” <em>Statistics in Medicine</em> 22 (5): 763–80. <a href="https://doi.org/10.1002/sim.1399">https://doi.org/10.1002/sim.1399</a>.</p>
</div>
<div id="ref-Thall2004">
<p>Thall, PF, and JD Cook. 2004. “Dose-Finding Based on Efficacy-Toxicity Trade-Offs.” <em>Biometrics</em> 60 (3): 684–93.</p>
</div>
<div id="ref-Thall2014">
<p>Thall, PF, RC Herrick, HQ Nguyen, JJ Venier, and JC Norris. 2014. “Effective sample size for computing prior hyperparameters in Bayesian phase I-II dose-finding.” <em>Clinical Trials</em> 11 (6): 657–66. <a href="https://doi.org/10.1177/1740774514547397">https://doi.org/10.1177/1740774514547397</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#examples">Examples</a><ul class="nav nav-pills nav-stacked">
<li><a href="#crm">CRM</a></li>
      <li><a href="#efftox">EffTox</a></li>
      <li><a href="#hierachical-analysis-of-response-in-related-cohorts">Hierachical analysis of response in related cohorts</a></li>
      <li><a href="#bebop-in-peps2">BEBOP in PePS2</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kristian Brock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
