<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CRM Case Study 1 - Levy et al (2006) • trialr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="CRM Case Study 1 - Levy et al (2006)">
<meta property="og:description" content="trialr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trialr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/BEBOP.html">BEBOP in PePS2</a>
    </li>
    <li>
      <a href="../articles/CRM-pathways.html">Dose pathways with CRM</a>
    </li>
    <li>
      <a href="../articles/CRM-visualisation.html">Visualisation with CRM</a>
    </li>
    <li>
      <a href="../articles/CRM.html">Continual Reassessment Method</a>
    </li>
    <li>
      <a href="../articles/EffTox.html">EffTox</a>
    </li>
    <li>
      <a href="../articles/HierarchicalBayesianResponse.html">Hierarchical Bayesian Model for Binary Responses</a>
    </li>
    <li>
      <a href="../articles/LevyCaseStudy.html">CRM Case Study 1 - Levy et al (2006)</a>
    </li>
    <li>
      <a href="../articles/TITE-CRM.html">Time-to-Event Continual Reassessment Method</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/brockk/trialr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>CRM Case Study 1 - Levy et al (2006)</h1>
                        <h4 class="author">Kristian Brock</h4>
            
            <h4 class="date">2020-04-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/brockk/trialr/blob/master/vignettes/LevyCaseStudy.Rmd"><code>vignettes/LevyCaseStudy.Rmd</code></a></small>
      <div class="hidden name"><code>LevyCaseStudy.Rmd</code></div>

    </div>

    
    
<p>The Continual Reassessment Method (CRM) for dose-finding is introduced in <a href="CRM.html">its own article</a>. This vignette reproduces the analysis in a real dose-finding trial that used the CRM by <span class="citation">Levy et al. (2006)</span>. The chosen example is particularly attractive because the authors present sequential analyses of their dose decisions in their Table 1, allowing us the opportunity to reproduce their analysis.</p>
<p>The authors investigate five doses of semisynthetic homoharringtonine (ssHHT), seeking a dose associated with a dose-limiting toxicity (DLT) probability of approximately 33%. The specific doses and the investigators’ initial beliefs on the probabilities of DLT are:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(
  <span class="kw">`Dose-level`</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">5</span>,
  <span class="kw">`Dose (mg/m2 per day)`</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">6</span>),
  <span class="kw">`Prior Pr(DLT)`</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.33</span>, <span class="fl">0.5</span>)
) <span class="kw">%&gt;%</span> <span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">Dose-level</th>
<th align="right">Dose (mg/m2 per day)</th>
<th align="right">Prior Pr(DLT)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.5</td>
<td align="right">0.05</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1.0</td>
<td align="right">0.10</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">3.0</td>
<td align="right">0.15</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">5.0</td>
<td align="right">0.33</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">6.0</td>
<td align="right">0.50</td>
</tr>
</tbody>
</table>
<p>We are not told the exact details of the model form or the parameter prior(s) used. However, we are told that the BPCT software was used to calculate the recommended doses. <span class="citation">Zohar et al. (2003)</span> describe the software as using a one-parameter logistic model with fixed-value intercept taking possible values 1, 2, 3 or 4, and exponential or uniform priors on the gradient term with expected value 0.5, 1 or 2. For the purposes of this article, we assume that the investigators used a one-parameter logistic CRM with the intercept term fixed at <span class="math inline">\(a_0 = 1\)</span> and an Exponential(1) = Gamma(1, 1) prior on <span class="math inline">\(\beta\)</span>. In the appendix, we describe an attempt to identify the exact parameterisation used by comparing a broad array of model fits.</p>
<div id="prior-beliefs" class="section level2">
<h2 class="hasAnchor">
<a href="#prior-beliefs" class="anchor"></a>Prior beliefs</h2>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">trialr</span>)
<span class="co">#&gt; Loading required package: Rcpp</span>

<span class="no">target</span> <span class="kw">&lt;-</span> <span class="fl">0.33</span>
<span class="no">skeleton</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.33</span>, <span class="fl">0.5</span>)

<span class="no">fit0</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/crm_prior_beliefs.html">crm_prior_beliefs</a></span>(<span class="no">skeleton</span>, <span class="no">target</span>, <span class="kw">model</span> <span class="kw">=</span> <span class="st">'logistic_gamma'</span>,
                          <span class="kw">a0</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_shape</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_inverse_scale</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">fit0</span>
<span class="co">#&gt; No patients have been treated.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Dose Skeleton N Tox ProbTox MedianProbTox ProbMTD</span>
<span class="co">#&gt; 1    1     0.05 0   0   0.268         0.192  0.4173</span>
<span class="co">#&gt; 2    2     0.10 0   0   0.307         0.274  0.0568</span>
<span class="co">#&gt; 3    3     0.15 0   0   0.338         0.334  0.1067</span>
<span class="co">#&gt; 4    4     0.33 0   0   0.434         0.486  0.1805</span>
<span class="co">#&gt; 5    5     0.50 0   0   0.535         0.594  0.2387</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model targets a toxicity level of 0.33.</span>
<span class="co">#&gt; The dose with estimated toxicity probability closest to target is 3.</span>
<span class="co">#&gt; The dose most likely to be the MTD is 1.</span>
<span class="co">#&gt; Model entropy: 1.42</span></pre></body></html></div>
<p>Notice that both the prior mean (<code>ProbTox</code>) and median (<code>MedianProbTox</code>) probabilities of toxicity are quite far from the skeleton.</p>
<p>In an ordinary regression model, fixing the intercept will affect the gradient. The same is true here:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">purrr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)

<span class="no">get_prior_fit</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">a0</span>) {
  <span class="fu"><a href="../reference/crm_prior_beliefs.html">crm_prior_beliefs</a></span>(<span class="no">skeleton</span>, <span class="no">target</span>,
                    <span class="kw">model</span> <span class="kw">=</span> <span class="st">'logistic_gamma'</span>, <span class="kw">a0</span> <span class="kw">=</span> <span class="no">a0</span>,
                    <span class="kw">beta_shape</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_inverse_scale</span> <span class="kw">=</span> <span class="fl">1</span>)
}

<span class="fu"><a href="https://tidyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">a0</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">Mod</span> <span class="kw">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="no">a0</span>, <span class="no">get_prior_fit</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">Dose</span> <span class="kw">=</span> <span class="no">Mod</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="st">"dose_indices"</span>),
    <span class="kw">ProbTox</span> <span class="kw">=</span> <span class="no">Mod</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="st">"prob_tox"</span>),
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">Mod</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">Dose</span>, <span class="no">ProbTox</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">a0</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">a0</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Dose</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">ProbTox</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">a0</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">a0</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="fl">0</span>, <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">'Prior Prob(DLT) location is affected by the fixed intercept, a0'</span>)</pre></body></html></div>
<p><img src="LevyCaseStudy_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>Please note that the behaviour of <code>unnest</code> changed in v1.0 of the <code>tidyr</code> package. For older versions, the command should be:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://tidyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">a0</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">Mod</span> <span class="kw">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="no">a0</span>, <span class="no">get_prior_fit</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">Dose</span> <span class="kw">=</span> <span class="no">Mod</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="st">"dose_indices"</span>),
    <span class="kw">ProbTox</span> <span class="kw">=</span> <span class="no">Mod</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="st">"prob_tox"</span>),
    ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">Mod</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">Dose</span>, <span class="no">ProbTox</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">a0</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">a0</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Dose</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">ProbTox</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">a0</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">a0</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="fl">0</span>, <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">'Prior Prob(DLT) location is affected by the fixed intercept, a0'</span>)</pre></body></html></div>
</div>
<div id="cohort-1" class="section level2">
<h2 class="hasAnchor">
<a href="#cohort-1" class="anchor"></a>Cohort 1</h2>
<p>The trial starts at the lowest dose, 0.5 mg/m2 per day. Three patients are treated and none experiences DLT.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">fit1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stan_crm.html">stan_crm</a></span>(<span class="kw">outcome_str</span> <span class="kw">=</span> <span class="st">'1NNN'</span>,
                 <span class="kw">skeleton</span> <span class="kw">=</span> <span class="no">skeleton</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">target</span>, <span class="kw">model</span> <span class="kw">=</span> <span class="st">'logistic_gamma'</span>,
                 <span class="kw">a0</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_shape</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_inverse_scale</span> <span class="kw">=</span> <span class="fl">1</span>,
                 <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">123</span>, <span class="kw">control</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">adapt_delta</span> <span class="kw">=</span> <span class="fl">0.99</span>))</pre></body></html></div>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">fit1</span>
<span class="co">#&gt;   Patient Dose Toxicity Weight</span>
<span class="co">#&gt; 1       1    1        0      1</span>
<span class="co">#&gt; 2       2    1        0      1</span>
<span class="co">#&gt; 3       3    1        0      1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Dose Skeleton N Tox ProbTox MedianProbTox ProbMTD</span>
<span class="co">#&gt; 1    1     0.05 3   0   0.083        0.0214  0.0865</span>
<span class="co">#&gt; 2    2     0.10 0   0   0.117        0.0517  0.0398</span>
<span class="co">#&gt; 3    3     0.15 0   0   0.149        0.0876  0.1120</span>
<span class="co">#&gt; 4    4     0.33 0   0   0.266        0.2520  0.2940</span>
<span class="co">#&gt; 5    5     0.50 0   0   0.414        0.4446  0.4677</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model targets a toxicity level of 0.33.</span>
<span class="co">#&gt; The dose with estimated toxicity probability closest to target is 4.</span>
<span class="co">#&gt; The dose most likely to be the MTD is 5.</span>
<span class="co">#&gt; Model entropy: 1.30</span></pre></body></html></div>
<p>We see that the cohort has a great bearing on the predicted rates of toxicity. The trialists report estimated DLT probabilities of 0.001, 0.003, 0.006, 0.035, 0.11. The values calculated by <code>trialr</code> diverge somewhat from those values. It is difficult to know why this is given such a small sample size.</p>
<p>Dose-level 5 is recommended for the next cohort. The trialists understandably resist the desire to skip three doses in going from the lowest to highest dose, electing instead to skip the second dose and treat the next cohort at dose-level 3.</p>
</div>
<div id="cohort-2" class="section level2">
<h2 class="hasAnchor">
<a href="#cohort-2" class="anchor"></a>Cohort 2</h2>
<p>This cohort of three was treated at 3 mg/m2 per day. One DLT was seen.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">fit2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stan_crm.html">stan_crm</a></span>(<span class="kw">outcome_str</span> <span class="kw">=</span> <span class="st">'1NNN 3NNT'</span>,
                 <span class="kw">skeleton</span> <span class="kw">=</span> <span class="no">skeleton</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">target</span>, <span class="kw">model</span> <span class="kw">=</span> <span class="st">'logistic_gamma'</span>,
                 <span class="kw">a0</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_shape</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_inverse_scale</span> <span class="kw">=</span> <span class="fl">1</span>,
                 <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">123</span>, <span class="kw">control</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">adapt_delta</span> <span class="kw">=</span> <span class="fl">0.99</span>))</pre></body></html></div>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">fit2</span>
<span class="co">#&gt;   Patient Dose Toxicity Weight</span>
<span class="co">#&gt; 1       1    1        0      1</span>
<span class="co">#&gt; 2       2    1        0      1</span>
<span class="co">#&gt; 3       3    1        0      1</span>
<span class="co">#&gt; 4       4    3        0      1</span>
<span class="co">#&gt; 5       5    3        0      1</span>
<span class="co">#&gt; 6       6    3        1      1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Dose Skeleton N Tox ProbTox MedianProbTox ProbMTD</span>
<span class="co">#&gt; 1    1     0.05 3   0   0.147         0.101  0.1588</span>
<span class="co">#&gt; 2    2     0.10 0   0   0.203         0.171  0.0963</span>
<span class="co">#&gt; 3    3     0.15 3   1   0.250         0.230  0.2190</span>
<span class="co">#&gt; 4    4     0.33 0   0   0.397         0.407  0.3842</span>
<span class="co">#&gt; 5    5     0.50 0   0   0.533         0.548  0.1417</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model targets a toxicity level of 0.33.</span>
<span class="co">#&gt; The dose with estimated toxicity probability closest to target is 4.</span>
<span class="co">#&gt; The dose most likely to be the MTD is 4.</span>
<span class="co">#&gt; Model entropy: 1.49</span></pre></body></html></div>
<p>The trialists report Prob(DLT) = (0.07, 0.14, 0.19, 0.39, 0.55). The median estimates from <code>trialr</code> are now quite close to these values. Despite the observation of a DLT and the observed DLT-rate at dos-level 3 matching the target of 33%, the model advocates escalation to dose-level 4. That is what the investigators did.</p>
</div>
<div id="cohort-3" class="section level2">
<h2 class="hasAnchor">
<a href="#cohort-3" class="anchor"></a>Cohort 3</h2>
<p>This cohort of three was treated at dose-level 4, which corresponds to 5 mg/m2 per day. Once again, one DLT was seen.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">fit3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stan_crm.html">stan_crm</a></span>(<span class="kw">outcome_str</span> <span class="kw">=</span> <span class="st">'1NNN 3NNT 4NNT'</span>,
                 <span class="kw">skeleton</span> <span class="kw">=</span> <span class="no">skeleton</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">target</span>, <span class="kw">model</span> <span class="kw">=</span> <span class="st">'logistic_gamma'</span>,
                 <span class="kw">a0</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_shape</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_inverse_scale</span> <span class="kw">=</span> <span class="fl">1</span>,
                 <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">123</span>, <span class="kw">control</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">adapt_delta</span> <span class="kw">=</span> <span class="fl">0.99</span>))</pre></body></html></div>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">fit3</span>
<span class="co">#&gt;   Patient Dose Toxicity Weight</span>
<span class="co">#&gt; 1       1    1        0      1</span>
<span class="co">#&gt; 2       2    1        0      1</span>
<span class="co">#&gt; 3       3    1        0      1</span>
<span class="co">#&gt; 4       4    3        0      1</span>
<span class="co">#&gt; 5       5    3        0      1</span>
<span class="co">#&gt; 6       6    3        1      1</span>
<span class="co">#&gt; 7       7    4        0      1</span>
<span class="co">#&gt; 8       8    4        0      1</span>
<span class="co">#&gt; 9       9    4        1      1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Dose Skeleton N Tox ProbTox MedianProbTox ProbMTD</span>
<span class="co">#&gt; 1    1     0.05 3   0   0.129        0.0904  0.1027</span>
<span class="co">#&gt; 2    2     0.10 0   0   0.186        0.1569  0.0875</span>
<span class="co">#&gt; 3    3     0.15 3   1   0.235        0.2153  0.2370</span>
<span class="co">#&gt; 4    4     0.33 3   1   0.389        0.3935  0.4557</span>
<span class="co">#&gt; 5    5     0.50 0   0   0.531        0.5402  0.1170</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model targets a toxicity level of 0.33.</span>
<span class="co">#&gt; The dose with estimated toxicity probability closest to target is 4.</span>
<span class="co">#&gt; The dose most likely to be the MTD is 4.</span>
<span class="co">#&gt; Model entropy: 1.40</span></pre></body></html></div>
<p>The trialists report Prob(DLT) = (0.07, 0.13, 0.19, 0.38, 0.54) after this cohort, barely shifting from the previous estimates. This time the model advocates to remain at dose-level 4 and that is exactly what the trialists did.</p>
</div>
<div id="cohort-4" class="section level2">
<h2 class="hasAnchor">
<a href="#cohort-4" class="anchor"></a>Cohort 4</h2>
<p>This cohort of three was also treated at dose-level 4. No DLTs were seen in this cohort.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">fit4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stan_crm.html">stan_crm</a></span>(<span class="kw">outcome_str</span> <span class="kw">=</span> <span class="st">'1NNN 3NNT 4NNT 4NNN'</span>,
                 <span class="kw">skeleton</span> <span class="kw">=</span> <span class="no">skeleton</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">target</span>, <span class="kw">model</span> <span class="kw">=</span> <span class="st">'logistic_gamma'</span>,
                 <span class="kw">a0</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_shape</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_inverse_scale</span> <span class="kw">=</span> <span class="fl">1</span>,
                 <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">123</span>, <span class="kw">control</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">adapt_delta</span> <span class="kw">=</span> <span class="fl">0.99</span>))</pre></body></html></div>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">fit4</span>
<span class="co">#&gt;    Patient Dose Toxicity Weight</span>
<span class="co">#&gt; 1        1    1        0      1</span>
<span class="co">#&gt; 2        2    1        0      1</span>
<span class="co">#&gt; 3        3    1        0      1</span>
<span class="co">#&gt; 4        4    3        0      1</span>
<span class="co">#&gt; 5        5    3        0      1</span>
<span class="co">#&gt; 6        6    3        1      1</span>
<span class="co">#&gt; 7        7    4        0      1</span>
<span class="co">#&gt; 8        8    4        0      1</span>
<span class="co">#&gt; 9        9    4        1      1</span>
<span class="co">#&gt; 10      10    4        0      1</span>
<span class="co">#&gt; 11      11    4        0      1</span>
<span class="co">#&gt; 12      12    4        0      1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Dose Skeleton N Tox ProbTox MedianProbTox ProbMTD</span>
<span class="co">#&gt; 1    1     0.05 3   0  0.0723        0.0428  0.0328</span>
<span class="co">#&gt; 2    2     0.10 0   0  0.1184        0.0886  0.0338</span>
<span class="co">#&gt; 3    3     0.15 3   1  0.1616        0.1361  0.1452</span>
<span class="co">#&gt; 4    4     0.33 6   1  0.3191        0.3145  0.5320</span>
<span class="co">#&gt; 5    5     0.50 0   0  0.4842        0.4896  0.2562</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model targets a toxicity level of 0.33.</span>
<span class="co">#&gt; The dose with estimated toxicity probability closest to target is 4.</span>
<span class="co">#&gt; The dose most likely to be the MTD is 4.</span>
<span class="co">#&gt; Model entropy: 1.19</span></pre></body></html></div>
<p>The trialists report Prob(DLT) = (0.03, 0.07, 0.11, 0.27, 0.45) after this cohort. <code>ProbMTD</code> shows the implied probability that each dose is the <em>maximum tolerable dose</em>, that is, the dose with Prob(DLT) closest to the toxicity target, 33%. The observation of no DLTs in this cohort means it is now very unlikely that dose-levels 1 and 2 are the true MTD. The amount of entropy in the experiment has fallen to reflect this. Once again, the model advocates to remaining at dose-level 4.</p>
</div>
<div id="cohort-5" class="section level2">
<h2 class="hasAnchor">
<a href="#cohort-5" class="anchor"></a>Cohort 5</h2>
<p>This cohort was also treated at dose-level 4. One-out-of-three DLTs were seen.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">fit5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stan_crm.html">stan_crm</a></span>(<span class="kw">outcome_str</span> <span class="kw">=</span> <span class="st">'1NNN 3NNT 4NNT 4NNN 4NTN'</span>,
                 <span class="kw">skeleton</span> <span class="kw">=</span> <span class="no">skeleton</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">target</span>, <span class="kw">model</span> <span class="kw">=</span> <span class="st">'logistic_gamma'</span>,
                 <span class="kw">a0</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_shape</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_inverse_scale</span> <span class="kw">=</span> <span class="fl">1</span>,
                 <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">123</span>, <span class="kw">control</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">adapt_delta</span> <span class="kw">=</span> <span class="fl">0.99</span>))</pre></body></html></div>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">fit5</span>
<span class="co">#&gt;    Patient Dose Toxicity Weight</span>
<span class="co">#&gt; 1        1    1        0      1</span>
<span class="co">#&gt; 2        2    1        0      1</span>
<span class="co">#&gt; 3        3    1        0      1</span>
<span class="co">#&gt; 4        4    3        0      1</span>
<span class="co">#&gt; 5        5    3        0      1</span>
<span class="co">#&gt; 6        6    3        1      1</span>
<span class="co">#&gt; 7        7    4        0      1</span>
<span class="co">#&gt; 8        8    4        0      1</span>
<span class="co">#&gt; 9        9    4        1      1</span>
<span class="co">#&gt; 10      10    4        0      1</span>
<span class="co">#&gt; 11      11    4        0      1</span>
<span class="co">#&gt; 12      12    4        0      1</span>
<span class="co">#&gt; 13      13    4        0      1</span>
<span class="co">#&gt; 14      14    4        1      1</span>
<span class="co">#&gt; 15      15    4        0      1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Dose Skeleton N Tox ProbTox MedianProbTox ProbMTD</span>
<span class="co">#&gt; 1    1     0.05 3   0  0.0726        0.0501  0.0255</span>
<span class="co">#&gt; 2    2     0.10 0   0  0.1212        0.1001  0.0260</span>
<span class="co">#&gt; 3    3     0.15 3   1  0.1667        0.1502  0.1507</span>
<span class="co">#&gt; 4    4     0.33 9   2  0.3288        0.3302  0.6085</span>
<span class="co">#&gt; 5    5     0.50 0   0  0.4927        0.5001  0.1893</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model targets a toxicity level of 0.33.</span>
<span class="co">#&gt; The dose with estimated toxicity probability closest to target is 4.</span>
<span class="co">#&gt; The dose most likely to be the MTD is 4.</span>
<span class="co">#&gt; Model entropy: 1.09</span></pre></body></html></div>
<p>The trialists report Prob(DLT) = (0.04, 0.08, 0.12, 0.29, 0.46).</p>
</div>
<div id="cohort-6" class="section level2">
<h2 class="hasAnchor">
<a href="#cohort-6" class="anchor"></a>Cohort 6</h2>
<p>This cohort was also treated at dose-level 4. Two-out-of-three DLTs were seen.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">fit6</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stan_crm.html">stan_crm</a></span>(<span class="kw">outcome_str</span> <span class="kw">=</span> <span class="st">'1NNN 3NNT 4NNT 4NNN 4NTN 4TNT'</span>,
                 <span class="kw">skeleton</span> <span class="kw">=</span> <span class="no">skeleton</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">target</span>, <span class="kw">model</span> <span class="kw">=</span> <span class="st">'logistic_gamma'</span>,
                 <span class="kw">a0</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_shape</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_inverse_scale</span> <span class="kw">=</span> <span class="fl">1</span>,
                 <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">123</span>, <span class="kw">control</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">adapt_delta</span> <span class="kw">=</span> <span class="fl">0.99</span>))</pre></body></html></div>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">fit6</span>
<span class="co">#&gt;    Patient Dose Toxicity Weight</span>
<span class="co">#&gt; 1        1    1        0      1</span>
<span class="co">#&gt; 2        2    1        0      1</span>
<span class="co">#&gt; 3        3    1        0      1</span>
<span class="co">#&gt; 4        4    3        0      1</span>
<span class="co">#&gt; 5        5    3        0      1</span>
<span class="co">#&gt; 6        6    3        1      1</span>
<span class="co">#&gt; 7        7    4        0      1</span>
<span class="co">#&gt; 8        8    4        0      1</span>
<span class="co">#&gt; 9        9    4        1      1</span>
<span class="co">#&gt; 10      10    4        0      1</span>
<span class="co">#&gt; 11      11    4        0      1</span>
<span class="co">#&gt; 12      12    4        0      1</span>
<span class="co">#&gt; 13      13    4        0      1</span>
<span class="co">#&gt; 14      14    4        1      1</span>
<span class="co">#&gt; 15      15    4        0      1</span>
<span class="co">#&gt; 16      16    4        1      1</span>
<span class="co">#&gt; 17      17    4        0      1</span>
<span class="co">#&gt; 18      18    4        1      1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Dose Skeleton  N Tox ProbTox MedianProbTox ProbMTD</span>
<span class="co">#&gt; 1    1     0.05  3   0   0.104        0.0751  0.0490</span>
<span class="co">#&gt; 2    2     0.10  0   0   0.161        0.1364  0.0653</span>
<span class="co">#&gt; 3    3     0.15  3   1   0.211        0.1925  0.2313</span>
<span class="co">#&gt; 4    4     0.33 12   4   0.374        0.3728  0.5647</span>
<span class="co">#&gt; 5    5     0.50  0   0   0.524        0.5275  0.0897</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model targets a toxicity level of 0.33.</span>
<span class="co">#&gt; The dose with estimated toxicity probability closest to target is 4.</span>
<span class="co">#&gt; The dose most likely to be the MTD is 4.</span>
<span class="co">#&gt; Model entropy: 1.20</span></pre></body></html></div>
<p>The trialists report Prob(DLT) = (0.06, 0.12, 0.17, 0.36, 0.53). Prob(MTD) actually decreased and the scenario entropy increased after the evaluation of these three patients, because the observation of two-in-three DLTs was slightly surprising to the model. Nevertheless, the trialists stopped here and concluded that 5 mg/m2 per day was probably the MTD. They reported a 95% credibility interval for the DLT rate at this dose to be (15.8, 58.6%). We can verify this:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">fit6</span>, <span class="kw">pars</span> <span class="kw">=</span> <span class="st">'prob_tox'</span>), <span class="fl">2</span>, <span class="no">quantile</span>,
      <span class="kw">probs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))
<span class="co">#&gt;       prob_tox[1] prob_tox[2] prob_tox[3] prob_tox[4] prob_tox[5]</span>
<span class="co">#&gt; 2.5%  0.007936399  0.02356285  0.04562227   0.1788696   0.3828175</span>
<span class="co">#&gt; 97.5% 0.339954375  0.41377685  0.46175719   0.5694487   0.6406686</span></pre></body></html></div>
<p>The 95% CI at dose-level 4 is very close to that reported.</p>
<p>They say “The estimated DLT probability associated with the dose level of 5mg/m2 would have been expected to change by less than 5% even if three further patients were included.” It is possible to show this with <a href="CRM-pathways.html">DTPs</a>.</p>
<p>The prevailing probability of toxicity given the patients evaluated thus far is:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">prob_tox_mtd</span> <span class="kw">&lt;-</span> <span class="no">fit6</span>$<span class="no">prob_tox</span>[<span class="no">fit6</span>$<span class="no">recommended_dose</span>]
<span class="no">prob_tox_mtd</span>
<span class="co">#&gt; [1] 0.3743222</span></pre></body></html></div>
<p>We calculate the future pathways for a single additional cohort of 3 patients, conditional on the outcomes observed hitherto:</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">paths</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/crm_dtps.html">crm_dtps</a></span>(<span class="kw">skeleton</span> <span class="kw">=</span> <span class="no">skeleton</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">target</span>,
                  <span class="kw">model</span> <span class="kw">=</span> <span class="st">'logistic_gamma'</span>, <span class="kw">cohort_sizes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>),
                  <span class="kw">previous_outcomes</span> <span class="kw">=</span> <span class="st">'1NNN 3NNT 4NNT 4NNN 4NTN 4TNT'</span>,
                  <span class="kw">a0</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_shape</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta_inverse_scale</span> <span class="kw">=</span> <span class="fl">1</span>,
                  <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">123</span>, <span class="kw">control</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">adapt_delta</span> <span class="kw">=</span> <span class="fl">0.99</span>), <span class="kw">refresh</span> <span class="kw">=</span> <span class="fl">0</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>(<span class="no">paths</span>)</pre></body></html></div>
<p>The putative future inferences on the probability of toxicity at dose-level 4 conditional on each of the four possible cohort outcomes are:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">purrr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)

<span class="no">df</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">prob_tox</span> <span class="kw">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="no">fit</span>, <span class="st">'prob_tox'</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">fit</span>, -<span class="no">parent_fit</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">dose_index</span>, <span class="no">prob_tox</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">dose_index</span> <span class="kw">==</span> <span class="fl">4</span>)
<span class="co">#&gt; New names:</span>
<span class="co">#&gt; * `` -&gt; ...1</span>
<span class="co">#&gt; * `` -&gt; ...2</span>
<span class="co">#&gt; * `` -&gt; ...3</span>
<span class="co">#&gt; * `` -&gt; ...4</span>
<span class="co">#&gt; * `` -&gt; ...5</span>
<span class="co">#&gt; # A tibble: 5 x 7</span>
<span class="co">#&gt;   .node .parent .depth outcomes next_dose dose_index prob_tox</span>
<span class="co">#&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1      NA      0 ""               4          4    0.374</span>
<span class="co">#&gt; 2     2       1      1 "NNN"            4          4    0.334</span>
<span class="co">#&gt; 3     3       1      1 "NNT"            4          4    0.370</span>
<span class="co">#&gt; 4     4       1      1 "NTT"            4          4    0.410</span>
<span class="co">#&gt; 5     5       1      1 "TTT"            3          4    0.443</span></pre></body></html></div>
<p>We can put this data into a format conducive to reproducing the trialists’ claim.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">df</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">.depth</span> <span class="kw">&gt;</span> <span class="fl">0</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">prob_tox</span> <span class="kw">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="no">fit</span>, <span class="st">'prob_tox'</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">fit</span>, -<span class="no">parent_fit</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">dose_index</span>, <span class="no">prob_tox</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">dose_index</span> <span class="kw">==</span> <span class="fl">4</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">outcomes</span>, <span class="no">prob_tox</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(
    <span class="kw">lik</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">dbinom</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fl">0</span>:<span class="fl">3</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">prob</span> <span class="kw">=</span> <span class="no">prob_tox_mtd</span>)) <span class="kw">-&gt;</span> <span class="no">future_scenario</span>

<span class="no">future_scenario</span>
<span class="co">#&gt; # A tibble: 4 x 3</span>
<span class="co">#&gt;   outcomes prob_tox    lik</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 NNN         0.334 0.245 </span>
<span class="co">#&gt; 2 NNT         0.370 0.440 </span>
<span class="co">#&gt; 3 NTT         0.410 0.263 </span>
<span class="co">#&gt; 4 TTT         0.443 0.0524</span></pre></body></html></div>
<p>Above we see the likelihood of the four possible outcomes, inferred using binomial probabilities and the prevailing probability of toxicity at dose-level 4. The outcome <code>TTT</code> would increase the probability by over 5% but that scenario is unlikely, given what we know.</p>
<p>The expected change is indeed less than 5%:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">future_scenario</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">prob_tox_change</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">prob_tox</span> - <span class="no">prob_tox_mtd</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="kw">expected_change</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">lik</span> * <span class="no">prob_tox_change</span>))
<span class="co">#&gt; # A tibble: 1 x 1</span>
<span class="co">#&gt;   expected_change</span>
<span class="co">#&gt;             &lt;dbl&gt;</span>
<span class="co">#&gt; 1          0.0244</span></pre></body></html></div>
<p>This concludes the main case study on <span class="citation">Levy et al. (2006)</span>. The section below details an honest but ultimately unsuccessful attempt to infer the precise parameterisation used by the trialists.</p>
</div>
<div id="trying-to-identify-the-exact-model-levy-et-al-used" class="section level1">
<h1 class="hasAnchor">
<a href="#trying-to-identify-the-exact-model-levy-et-al-used" class="anchor"></a>Trying to identify the exact model Levy et al. used</h1>
<p>At the end of the trial, the investigators reported the estimated probabilities of DLT (0.06, 0.12, 0.17, 0.36, 0.53). We will fit models using an exponential prior and each combination of <code>a_0 = 1, 2, 3, 4</code> and <code>beta_inverse_scale = 0.5, 1, 2</code> to the complete set of all outcomes observed. We seek the fit that yields inference closest to that of the investigators.</p>
<p>The investigators concluded:</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">levy_reported</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(
  <span class="kw">Dose</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">5</span>,
  <span class="kw">ProbTox</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.06</span>, <span class="fl">0.12</span>, <span class="fl">0.17</span>, <span class="fl">0.36</span>, <span class="fl">0.53</span>),
)</pre></body></html></div>
<p>We also define a helper function to fit the models:</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">fit_levy_crm</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">outcomes</span>, <span class="no">a0</span>, <span class="no">beta_inverse_scale</span>) {
  <span class="fu"><a href="../reference/stan_crm.html">stan_crm</a></span>(<span class="kw">outcome_str</span> <span class="kw">=</span> <span class="no">outcomes</span>,
           <span class="kw">skeleton</span> <span class="kw">=</span> <span class="no">skeleton</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">target</span>,
           <span class="kw">model</span> <span class="kw">=</span> <span class="st">'logistic_gamma'</span>,
           <span class="kw">a0</span> <span class="kw">=</span> <span class="no">a0</span>, <span class="kw">beta_shape</span> <span class="kw">=</span> <span class="fl">1</span>,
           <span class="kw">beta_inverse_scale</span> <span class="kw">=</span> <span class="no">beta_inverse_scale</span>,
           <span class="kw">control</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">adapt_delta</span> <span class="kw">=</span> <span class="fl">0.99</span>),
           <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">123</span>, <span class="kw">refresh</span> <span class="kw">=</span> <span class="fl">0</span>)
}</pre></body></html></div>
<p>This code block calculates the parameter combinations, fits the model to each, and extracts the posterior mean probability of DLT:</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(<span class="kw">a0</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">4</span>, <span class="kw">beta_inverse_scale</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">Series</span> <span class="kw">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span>(<span class="no">.</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">Mod</span> <span class="kw">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span>(<span class="no">a0</span>, <span class="no">beta_inverse_scale</span>, <span class="no">fit_levy_crm</span>,
                    <span class="kw">outcomes</span> <span class="kw">=</span> <span class="st">'1NNN 3NNT 4NNT 4NNN 4NTN 4TNT'</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">Dose</span> <span class="kw">=</span> <span class="no">Mod</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="st">"dose_indices"</span>),
    <span class="kw">ProbTox</span> <span class="kw">=</span> <span class="no">Mod</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="st">"prob_tox"</span>),
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">Mod</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">Dose</span>, <span class="no">ProbTox</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">a0</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">a0</span>),
         <span class="kw">beta_inverse_scale</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">beta_inverse_scale</span>)) <span class="kw">-&gt;</span> <span class="no">all_fits</span></pre></body></html></div>
<p>We then plot our inferences with the investigators’ inferences superimposed in bright green. Plots are grouped by the value for <code>beta_inverse_scale</code> in columns, and values for <code>a0</code> are reflected by colour:</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">all_fits</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Dose</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">ProbTox</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">group</span> <span class="kw">=</span> <span class="no">Series</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">a0</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">levy_reported</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'green'</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.2</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~ <span class="no">beta_inverse_scale</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="fl">0</span>, <span class="fl">0.7</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"None of the exponential models quite matches the investigators' inferences"</span>)</pre></body></html></div>
<p><img src="LevyCaseStudy_files/figure-html/unnamed-chunk-27-1.png" width="672"></p>
<p>We see that there is broad agreement at the higher doses but none of the series quite matches the investigators’ inferences. There are many possible explanations for the difference. The investigators might not have used an exponential prior. They might have use parameters we have not tested. They might have reported some statistic other than the posterior mean. <code>trialr</code> or their code or indeed both might be wrong. Either way, there is enough agreement to agree on the probable identity of the MTD.</p>
<div id="other-crm-vignettes" class="section level2">
<h2 class="hasAnchor">
<a href="#other-crm-vignettes" class="anchor"></a>Other CRM vignettes</h2>
<p>There are many vignettes illuminating the CRM in <code>trialr</code>:</p>
<ul>
<li><a href="CRM.html">An introduction to CRM in ‘trialr’</a></li>
<li><a href="CRM-visualisation.html">Visualisation in CRM</a></li>
<li><a href="TITE-CRM.html">TITE-CRM</a></li>
<li><a href="CRM-pathways.html">Pathways and stopping in CRM</a></li>
<li><a href="LevyCaseStudy.html">Case study using Levy, et al. (2006)</a></li>
<li>Simulation</li>
</ul>
</div>
</div>
<div id="trialr" class="section level1">
<h1 class="hasAnchor">
<a href="#trialr" class="anchor"></a>trialr</h1>
<p><code>trialr</code> is available at <a href="https://github.com/brockk/trialr" class="uri">https://github.com/brockk/trialr</a> and <a href="https://CRAN.R-project.org/package=trialr" class="uri">https://CRAN.R-project.org/package=trialr</a></p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Levy2006">
<p>Levy, V, S Zohar, C Bardin, A Vekhoff, D Chaoui, B Rio, O Legrand, et al. 2006. “A Phase I Dose-Finding and Pharmacokinetic Study of Subcutaneous Semisynthetic Homoharringtonine (ssHHT) in Patients with Advanced Acute Myeloid Leukaemia.” <em>British Journal of Cancer</em> 95 (3): 253–59. <a href="https://doi.org/10.1038/sj.bjc.6603265">https://doi.org/10.1038/sj.bjc.6603265</a>.</p>
</div>
<div id="ref-zoharSoftwareComputeConduct2003">
<p>Zohar, Sarah, Aurelien Latouche, Mathieu Taconnet, and Sylvie Chevret. 2003. “Software to Compute and Conduct Sequential Bayesian Phase I or II Dose-Ranging Clinical Trials with Stopping Rules.” <em>Computer Methods and Programs in Biomedicine</em> 72 (2): 117–25. <a href="https://doi.org/10.1016/S0169-2607(02)00120-7">https://doi.org/10.1016/S0169-2607(02)00120-7</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kristian Brock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
