<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The <code>trialr</code> package • trialr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">trialr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/trialr.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CRM.html">Continual Reassessment Method in `trialr`</a>
    </li>
    <li>
      <a href="../articles/EffTox.html">EffTox in trialr</a>
    </li>
    <li>
      <a href="../articles/HierarchicalBayesianResponse.html">Hierarchical Bayesian Model for Binary Responses</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/brockk/trialr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>The <code>trialr</code> package</h1>
                        <h4 class="author">Kristian Brock</h4>
            
            <h4 class="date">2018-03-04</h4>
          </div>

    
    
<div class="contents">
<p><code>trialr</code> is a collection of Bayesian clinical trial designs implemented in Stan and R.</p>
<p>Many notable Bayesian designs for clinical trials have been published. However, one of the factors that has constrained their adoption is availability of software. We present here some of the most popular, implemented and demonstrated in a consistent style, leveraging the powerful Stan environment.</p>
<p>It should be stressed that Bayesian trialists are not generally without code. Often authors make available code with their design publication. There are also some fantastic packages that aid the use of certain designs. However, challenges to use still persist. The disparate methods are naturally presented in a style that appeals to the particular author. Features implemented in one package for one design may be missing in another. Sometimes the technology chosen may only be available on one particular operating system, or the chosen technology may have fallen into disuse.</p>
<p><code>trialr</code> seeks to address these problems. Models are specified in <a href="http://mc-stan.org/">Stan</a>, a state-of-the-art environment for Bayesian analysis. It uses Hamiltonian Monte Carlo to take samples from the posterior distributions. This method is more efficient than Gibbs sampling, for instance, and reliable inference can be performed on a few thousand posterior samples. Both R and Stan are available on Mac, Linux, and Windows, and all the examples presented here should work on each operating system. Furthermore, Stan offers a very simple method to split the sampling across <em>n</em> cores, taking full advantage of the modern multicore processor in your computer (probably).</p>
<p>The designs implemented in <code>trialr</code> are introduced briefly below, and developed more fully in vignettes. We focus on real-life usage, including:</p>
<ul>
<li>fitting models to observed data using your prior;</li>
<li>processing posterior samples to produce useful inferences;</li>
<li>and visualising inferences using modern <code>ggplot</code> graphics.</li>
</ul>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h1>
<p>In all examples, we will need to load <code>trialr</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(trialr)</code></pre></div>
<div id="crm" class="section level2">
<h2 class="hasAnchor">
<a href="#crm" class="anchor"></a>CRM</h2>
<p>The Continual Reassessment Method was first published by O’Quigley, Pepe and Fisher (1990). It assumes a smooth mathematical form for the dose-toxicity curve to conduct a dose-finding trial seeking a maximum tolerable dose. There are many variations to suit different clinical scenarios and the design has enjoyed <em>relatively</em> common use (although nowhere near as common as the ubiquitous and inferior 3+3 design).</p>
<p>We illustrate the</p>
</div>
<div id="efftox" class="section level2">
<h2 class="hasAnchor">
<a href="#efftox" class="anchor"></a>EffTox</h2>
<p>Thall &amp; Cook’s EffTox is a dose-finding design that uses binary efficacy and toxicity outcomes to select a dose with a high utility score. We present it briefly here there is a much more thorough examination in the <a href="https://brockk.github.io/trialr/articles/EffTox.html">EffTox vignette</a>.</p>
<p>We include a convenience function to get parameters for the EffTox demo scenario of a study with five doses:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/efftox_parameters_demo.html">efftox_parameters_demo</a></span>()</code></pre></div>
<p>but generally you would specify parameters in a list. See the <a href="https://brockk.github.io/trialr/articles/EffTox.html">EffTox vignette</a> for full details.</p>
<p>Let us add outcomes for 3 patients:</p>
<ul>
<li>patient 1, treated at dose 1, has neither efficacy nor toxicity;</li>
<li>patient 2, treated at dose 2, has just efficacy;</li>
<li>and patients 3, treated at dose 3, has both:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat<span class="op">$</span>num_patients &lt;-<span class="st"> </span><span class="dv">3</span>
dat<span class="op">$</span>eff &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>)
dat<span class="op">$</span>tox &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)
dat<span class="op">$</span>doses &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</code></pre></div>
<p>To get posterior samples, we invoke Stan the model on our <code>dat</code> object. The EffTox model is include in <code>trialr</code> as <code>stanmodels$EffTox</code>. The <code>stanmodels</code> object is compiled when you install <code>trialr</code> and made available when you load the package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)
samp &lt;-<span class="st"> </span>rstan<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-sampling">sampling</a></span>(stanmodels<span class="op">$</span>EffTox, <span class="dt">data =</span> dat, <span class="dt">refresh =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Gradient evaluation took 9.6e-05 seconds</span>
<span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 0.96 seconds.</span>
<span class="co">#&gt; Adjust your expectations accordingly!</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Elapsed Time: 0.515862 seconds (Warm-up)</span>
<span class="co">#&gt;                0.383542 seconds (Sampling)</span>
<span class="co">#&gt;                0.899404 seconds (Total)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gradient evaluation took 3.8e-05 seconds</span>
<span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 0.38 seconds.</span>
<span class="co">#&gt; Adjust your expectations accordingly!</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Elapsed Time: 0.535456 seconds (Warm-up)</span>
<span class="co">#&gt;                0.388088 seconds (Sampling)</span>
<span class="co">#&gt;                0.923544 seconds (Total)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gradient evaluation took 3.7e-05 seconds</span>
<span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 0.37 seconds.</span>
<span class="co">#&gt; Adjust your expectations accordingly!</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Elapsed Time: 0.527302 seconds (Warm-up)</span>
<span class="co">#&gt;                0.371444 seconds (Sampling)</span>
<span class="co">#&gt;                0.898746 seconds (Total)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gradient evaluation took 3.8e-05 seconds</span>
<span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 0.38 seconds.</span>
<span class="co">#&gt; Adjust your expectations accordingly!</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Elapsed Time: 0.51292 seconds (Warm-up)</span>
<span class="co">#&gt;                0.380365 seconds (Sampling)</span>
<span class="co">#&gt;                0.893285 seconds (Total)</span></code></pre></div>
<p>The <code>efftox_process</code> function is provided to perform the calculations on the posterior samples necessary to follow the design published by Thall &amp; Cook:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">decision &lt;-<span class="st"> </span><span class="kw"><a href="../reference/efftox_process.html">efftox_process</a></span>(dat, samp)</code></pre></div>
<p>For instance, after evaluation of our three patients, the dose advocated for the next group is dose-level 3:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">decision<span class="op">$</span>recommended_dose
<span class="co">#&gt; [1] 3</span></code></pre></div>
<p>This is not surprising because dose 3 has the highest utility score:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">decision<span class="op">$</span>utility
<span class="co">#&gt; [1] -0.63555554  0.03034959  0.23273619 -0.04806662 -0.19326826</span></code></pre></div>
<p>Sometimes, doses other than the maximal-utility dose will be recommended because of the dose-admissibility rules. See the papers for details.</p>
<p>Functions are provided to create useful plots. For instance, it is illuminating to plot the posterior means of the probabilities of efficacy and toxicity at each of the doses on the trade-off contours. The five doses are shown in red. Doses closer to the lower-right corner have higher utility.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/efftox_contour_plot.html">efftox_contour_plot</a></span>(dat, <span class="dt">prob_eff =</span> decision<span class="op">$</span>prob_eff, <span class="dt">prob_tox =</span> decision<span class="op">$</span>prob_tox)
<span class="kw">title</span>(<span class="st">'EffTox utility contours'</span>)</code></pre></div>
<p><img src="trialr_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>This example continues in the <a href="https://brockk.github.io/trialr/articles/EffTox.html">EffTox vignette</a>.</p>
<p>There are many publications related to EffTox but the two most important are <em>Dose-Finding Based on Efficacy-Toxicity Trade-Offs</em> (Thall &amp; Cook, 2004) and <em>Effective sample size for computing prior hyperparameters in Bayesian phase I-II dose-finding</em> (Thall, Herrick, Nguyen, Venier &amp; Norris, 2014).</p>
</div>
<div id="hierachical-analysis-of-response-in-related-cohorts" class="section level2">
<h2 class="hasAnchor">
<a href="#hierachical-analysis-of-response-in-related-cohorts" class="anchor"></a>Hierachical analysis of response in related cohorts</h2>
<p>TODO</p>
</div>
<div id="bebop-in-peps2" class="section level2">
<h2 class="hasAnchor">
<a href="#bebop-in-peps2" class="anchor"></a>BEBOP in PePS2</h2>
<p>TODO</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#examples">Examples</a><ul class="nav nav-pills nav-stacked">
<li><a href="#crm">CRM</a></li>
      <li><a href="#efftox">EffTox</a></li>
      <li><a href="#hierachical-analysis-of-response-in-related-cohorts">Hierachical analysis of response in related cohorts</a></li>
      <li><a href="#bebop-in-peps2">BEBOP in PePS2</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kristian Brock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
