<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hierarchical Bayesian Model for Binary Responses • trialr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Hierarchical Bayesian Model for Binary Responses">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trialr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/BEBOP.html">BEBOP in PePS2</a>
    </li>
    <li>
      <a href="../articles/CRM-visualisation.html">Visualisation with CRM</a>
    </li>
    <li>
      <a href="../articles/CRM.html">Continual Reassessment Method</a>
    </li>
    <li>
      <a href="../articles/EffTox.html">EffTox in trialr</a>
    </li>
    <li>
      <a href="../articles/HierarchicalBayesianResponse.html">Hierarchical Bayesian Model for Binary Responses</a>
    </li>
    <li>
      <a href="../articles/trialr-overview.html">Overview of trialr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/brockk/trialr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Hierarchical Bayesian Model for Binary Responses</h1>
                        <h4 class="author">Kristian Brock</h4>
            
            <h4 class="date">2019-01-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/brockk/trialr/blob/master/vignettes/HierarchicalBayesianResponse.Rmd"><code>vignettes/HierarchicalBayesianResponse.Rmd</code></a></small>
      <div class="hidden name"><code>HierarchicalBayesianResponse.Rmd</code></div>

    </div>

    
    
<div id="hierarchical-bayesian-model-for-binary-responses" class="section level1">
<h1 class="hasAnchor">
<a href="#hierarchical-bayesian-model-for-binary-responses" class="anchor"></a>Hierarchical Bayesian model for binary responses</h1>
<p><span class="citation">Thall et al. (2003)</span> described a method for analysing treatment effects of a common intervention in several sub-types of a single disease. The treatment effects are assumed to be different but exchangeable and correlated. Observing good efficacy in one cohort, for example, increases one’s expectations of efficacy in other cohorts.</p>
<p>They demonstrate the hierarchical model in a trial with binary response outcomes and in another with time-to-event outcomes. This vignette describes the sarcoma example with binary response outcomes. The authors provide WinBUGS code in the appendix of their paper <span class="citation">(Thall et al. 2003)</span>. We port their model to Stan and illustrate usage with the example given in their paper.</p>
</div>
<div id="implementation-in-trialr" class="section level1">
<h1 class="hasAnchor">
<a href="#implementation-in-trialr" class="anchor"></a>Implementation in <code>trialr</code>
</h1>
<p>The model is compiled in <code>trialr</code> under the <code>ThallHierarchicalBinary</code> slot of the <code>stanmodels</code> object.</p>
<p>Statistically, the authors assume that in a trial of <span class="math inline">\(k\)</span> disease subtypes, the treatment effects are drawn from the same common normal distribution</p>
<p><span class="math inline">\(\rho_1, ..., \rho_k \sim N(\mu, \sigma^2)\)</span></p>
<p>As is the convention in BUGS, the authors define normal distributions by a precision parameter <span class="math inline">\(\tau\)</span> as opposed to the standard deviation parameter <span class="math inline">\(\sigma\)</span> used here. We have re-specified the model to comply with the Stan convention of using standard deviation. The authors use a normal hyperprior on <span class="math inline">\(\mu\)</span>, and a gamma hyperprior on <span class="math inline">\(\tau\)</span>, equivalent to an inverse gamma hyperprior on <span class="math inline">\(\sigma\)</span>.</p>
<p>We observe <span class="math inline">\(x_i\)</span> responses in <span class="math inline">\(n_i\)</span> patients in disease sub-type <span class="math inline">\(i\)</span>. The rate of response in subtype <span class="math inline">\(i\)</span> is modelled as <span class="math inline">\(p_i = \text{logit}^{-1}(\rho_i)\)</span>. Each <span class="math inline">\(x_i\)</span> is assumed to be binomially distributed with success parameter <span class="math inline">\(p_i\)</span>. In Stan, that relationship is described as <code>x ~ binomial_logit(n, rho);</code></p>
<p>The treatment is judged to be worthy of further investigation in cohort <span class="math inline">\(i\)</span> if</p>
<p><span class="math inline">\(\text{Pr}\left\{ p_i &gt; \theta | \mathcal{D} \right\} &gt; q\)</span></p>
<p>where <span class="math inline">\(\theta\)</span> is the minimum required response rate, and <span class="math inline">\(q\)</span> is the required certainty to approve. In their provided example, <span class="citation">Thall et al. (2003)</span> use <span class="math inline">\(\theta = 0.3\)</span>.</p>
</div>
<div id="example" class="section level1">
<h1 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h1>
<p>We can learn about the parameters required by the <code>ThallHierarchicalBinary</code> model using</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(trialr)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">help</span>(thallhierarchicalbinary_parameters)</a></code></pre></div>
<pre><code>## No documentation for 'thallhierarchicalbinary_parameters' in specified packages and libraries:
## you could try '??thallhierarchicalbinary_parameters'</code></pre>
<p>We can get an example using</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/thallhierarchicalbinary_parameters_demo.html">thallhierarchicalbinary_parameters_demo</a></span>()</a>
<a class="sourceLine" id="cb3-2" title="2">dat</a></code></pre></div>
<pre><code>## $m
## [1] 10
## 
## $x
##  [1] 0 0 1 3 5 0 1 2 0 0
## 
## $n
##  [1] 0 2 1 7 5 0 2 3 1 0
## 
## $target_resp
## [1] 0.3
## 
## $mu_mean
## [1] -1.3863
## 
## $mu_sd
## [1] 3.162278
## 
## $tau_alpha
## [1] 2
## 
## $tau_beta
## [1] 20</code></pre>
<p>We have outcomes in 10 disease subgroups. The number of responses is stored in <code>x</code> and the number of patients in <code>n</code>. There have been 3 / 7 responses in subgroup 4, for example, but 0 / 2 responses in subgroup 2, and zero patients treated at all in subgroups 1, 6 and 10.</p>
<p>We invoke the model by calling <code><a href="http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-sampling">rstan::sampling</a></code> on the included <code>ThallHierarchicalBinary</code> model. We set the seed for reproducble randomness.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">samp &lt;-<span class="st"> </span>rstan<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-sampling">sampling</a></span>(stanmodels<span class="op">$</span>ThallHierarchicalBinary, <span class="dt">data =</span> dat, </a>
<a class="sourceLine" id="cb5-2" title="2">                        <span class="dt">seed =</span> <span class="dv">123</span>)</a></code></pre></div>
<pre><code>## trying deprecated constructor; please alert package maintainer</code></pre>
<p>The probability that the efficacy probability in each subgroup exceeds the threshold is stored as <code>pg</code>. We extract that variable and use the <code>rstan::summary</code> function to make inference.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(rstan<span class="op">::</span><span class="kw">summary</span>(samp, <span class="dt">par =</span> <span class="st">'pg'</span>)<span class="op">$</span>summary, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="right">mean</th>
<th align="right">se_mean</th>
<th align="right">sd</th>
<th align="right">2.5%</th>
<th align="right">25%</th>
<th align="right">50%</th>
<th align="right">75%</th>
<th align="right">97.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>pg[1]</td>
<td align="right">0.542</td>
<td align="right">0.008</td>
<td align="right">0.498</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3535.715</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td>pg[2]</td>
<td align="right">0.088</td>
<td align="right">0.004</td>
<td align="right">0.284</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4071.151</td>
<td align="right">0.999</td>
</tr>
<tr class="odd">
<td>pg[3]</td>
<td align="right">0.946</td>
<td align="right">0.004</td>
<td align="right">0.225</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3393.444</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td>pg[4]</td>
<td align="right">0.748</td>
<td align="right">0.008</td>
<td align="right">0.434</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2862.118</td>
<td align="right">1.002</td>
</tr>
<tr class="odd">
<td>pg[5]</td>
<td align="right">1.000</td>
<td align="right">NaN</td>
<td align="right">0.016</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">NaN</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td>pg[6]</td>
<td align="right">0.516</td>
<td align="right">0.008</td>
<td align="right">0.500</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3784.143</td>
<td align="right">1.000</td>
</tr>
<tr class="odd">
<td>pg[7]</td>
<td align="right">0.708</td>
<td align="right">0.008</td>
<td align="right">0.455</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3087.661</td>
<td align="right">1.001</td>
</tr>
<tr class="even">
<td>pg[8]</td>
<td align="right">0.905</td>
<td align="right">0.006</td>
<td align="right">0.294</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2494.959</td>
<td align="right">1.002</td>
</tr>
<tr class="odd">
<td>pg[9]</td>
<td align="right">0.158</td>
<td align="right">0.006</td>
<td align="right">0.365</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3791.936</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td>pg[10]</td>
<td align="right">0.544</td>
<td align="right">0.009</td>
<td align="right">0.498</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3320.298</td>
<td align="right">1.000</td>
</tr>
</tbody>
</table>
<p>Let us say that we are willing to approve the treatment for further study in a subgroup if we have at least <span class="math inline">\(q = 70\)</span>% certainty that the probability of efficacy exceeds the target response rate of 30% On that basis, at this interim stage, we would be willing to approve the treatment in subgroups 3, 4, 5 and 8.</p>
<p>Some distribution plots of the probabilities of efficacy in some subgroups may be informative.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">library</span>(rstan)</a></code></pre></div>
<pre><code>## Loading required package: StanHeaders</code></pre>
<pre><code>## rstan (Version 2.18.1, GitRev: 2e1f913d3ca3)</code></pre>
<pre><code>## For execution on a local, multicore CPU with excess RAM we recommend calling
## options(mc.cores = parallel::detectCores()).
## To avoid recompilation of unchanged Stan programs, we recommend calling
## rstan_options(auto_write = TRUE)</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">library</span>(dplyr)</a></code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">as.data.frame</span>(samp, <span class="st">'p[3]'</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">ProbResponse =</span> <span class="st">`</span><span class="dt">p[3]</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> ProbResponse)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">'Prob(Response | D) in Sub-group 3'</span>)</a></code></pre></div>
<div class="figure">
<img src="HierarchicalBayesianResponse_files/figure-html/unnamed-chunk-5-1.png" alt="Prob(Response | D) in subgroup 3" width="576"><p class="caption">
Prob(Response | D) in subgroup 3
</p>
</div>
<p>We see that the inferred efficacy in subgroup 3 is very high.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">as.data.frame</span>(samp, <span class="st">'p[4]'</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">ProbResponse =</span> <span class="st">`</span><span class="dt">p[4]</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> ProbResponse)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">'Prob(Response | D) in Sub-group 4'</span>)</a></code></pre></div>
<div class="figure">
<img src="HierarchicalBayesianResponse_files/figure-html/unnamed-chunk-6-1.png" alt="Prob(Response | D) in subgroup 4" width="576"><p class="caption">
Prob(Response | D) in subgroup 4
</p>
</div>
<p>In contrast, efficacy is subject to more uncertainty in subgroup 4, but the majority of the mass clearly lies to the right of 30%.</p>
</div>
<div id="trialr" class="section level1">
<h1 class="hasAnchor">
<a href="#trialr" class="anchor"></a>trialr</h1>
<p><code>trialr</code> is available at <a href="https://github.com/brockk/trialr" class="uri">https://github.com/brockk/trialr</a></p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Thall2003">
<p>Thall, Peter F., J. Kyle Wathen, B. Nebiyou Bekele, Richard E. Champlin, Laurence H. Baker, and Robert S. Benjamin. 2003. “Hierarchical Bayesian approaches to phase II trials in diseases with multiple subtypes.” <em>Statistics in Medicine</em> 22 (5): 763–80. <a href="https://doi.org/10.1002/sim.1399">https://doi.org/10.1002/sim.1399</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#hierarchical-bayesian-model-for-binary-responses">Hierarchical Bayesian model for binary responses</a></li>
      <li><a href="#implementation-in-trialr">Implementation in <code>trialr</code></a></li>
      <li><a href="#example">Example</a></li>
      <li><a href="#trialr">trialr</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kristian Brock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
