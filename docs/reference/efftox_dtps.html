<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate dose-transition pathways for an EffTox study — efftox_dtps • trialr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Calculate dose-transition pathways for an EffTox study — efftox_dtps" />

<meta property="og:description" content="Calculate dose-transition pathways for an EffTox study.
The function efftox_dtps_to_dataframe performs a similar
function, but is much less-flexible." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trialr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/BEBOP.html">BEBOP in PePS2</a>
    </li>
    <li>
      <a href="../articles/CRM-pathways.html">Dose pathways with CRM</a>
    </li>
    <li>
      <a href="../articles/CRM-visualisation.html">Visualisation with CRM</a>
    </li>
    <li>
      <a href="../articles/CRM.html">Continual Reassessment Method</a>
    </li>
    <li>
      <a href="../articles/EffTox.html">EffTox</a>
    </li>
    <li>
      <a href="../articles/HierarchicalBayesianResponse.html">Hierarchical Bayesian Model for Binary Responses</a>
    </li>
    <li>
      <a href="../articles/LevyCaseStudy.html">CRM Case Study 1 - Levy et al (2006)</a>
    </li>
    <li>
      <a href="../articles/TITE-CRM.html">Time-to-Event Continual Reassessment Method</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/brockk/trialr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate dose-transition pathways for an EffTox study</h1>
    <small class="dont-index">Source: <a href='https://github.com/brockk/trialr/blob/master/R/efftox_dtps.R'><code>R/efftox_dtps.R</code></a></small>
    <div class="hidden name"><code>efftox_dtps.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Calculate dose-transition pathways for an EffTox study.
The function <code><a href='efftox_dtps_to_dataframe.html'>efftox_dtps_to_dataframe</a></code> performs a similar
function, but is much less-flexible.</p>
    
    </div>

    <pre class="usage"><span class='fu'>efftox_dtps</span>(<span class='no'>cohort_sizes</span>, <span class='kw'>previous_outcomes</span> <span class='kw'>=</span> <span class='st'>""</span>, <span class='kw'>next_dose</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>user_dose_func</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>i_am_patient</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>cohort_sizes</th>
      <td><p>vector of future cohort sizes, i.e. positive integers.
E.g. To calculate paths for the the next cohort of two followed by another
cohort of three, use <code>cohort_sizes = c(2, 3)</code>.</p></td>
    </tr>
    <tr>
      <th>previous_outcomes</th>
      <td><p>Outcomes observed hitherto in the syntax required
by <code><a href='efftox_parse_outcomes.html'>efftox_parse_outcomes</a></code>.</p></td>
    </tr>
    <tr>
      <th>next_dose</th>
      <td><p>the dose-level to be given to the immediately next cohort.</p></td>
    </tr>
    <tr>
      <th>user_dose_func</th>
      <td><p>optional delegate for deciding dose. A function that
takes a <code><a href='efftox_fit-class.html'>efftox_fit</a></code> as the sole argument and returns the integer
(1-based) dose-level to be given next, or NA to show that no dose should be
chosen and the trial stopped. This function gives the user the opportunity to
build in custom behaviour to tailor the dose selection decision in response
to the insights garnered by the fit model, or recommend that a trial path
be halted immediately. If omitted, the dose ordinarily chosen by the model is
used. An example is given below.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical, TRUE to get progress messages.</p></td>
    </tr>
    <tr>
      <th>i_am_patient</th>
      <td><p>logical, TRUE to show your tolerance for waiting for over 100
models to fit. Set to FALSE by default.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>extra params passed to <code><a href='http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-sampling'>rstan::sampling</a></code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>dose pathways in a <code>data.frame</code>.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Yap C, Billingham LJ, Cheung YK, Craddock C, O’Quigley J.
Dose transition pathways: The missing link between complex dose-finding
designs and simple decision-making. Clinical Cancer Research.
2017;23(24):7440-7447. doi:10.1158/1078-0432.CCR-17-0582</p>
<p>Brock K, Billingham L, Copland M, Siddique S, Sirovica M, Yap C.
Implementing the EffTox dose-finding design in the Matchpoint trial.
BMC Medical Research Methodology. 2017;17(1):112.
doi:10.1186/s12874-017-0381-x</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='efftox_parse_outcomes.html'>efftox_parse_outcomes</a></code>,
  <code><a href='stan_efftox.html'>stan_efftox</a></code>,
  <code><a href='efftox_path_analysis.html'>efftox_path_analysis</a></code>,
  <code><a href='dose_finding_path_node-class.html'>dose_finding_path_node</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'># Calculate paths for the first cohort of 3 in Thall et al 2014 example</span>
<span class='no'>paths1</span> <span class='kw'>&lt;-</span> <span class='fu'>efftox_dtps</span>(<span class='kw'>cohort_sizes</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>3</span>), <span class='kw'>next_dose</span> <span class='kw'>=</span> <span class='fl'>1</span>,
                      <span class='kw'>real_doses</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>1.0</span>, <span class='fl'>2.0</span>, <span class='fl'>4.0</span>, <span class='fl'>6.6</span>, <span class='fl'>10.0</span>),
                      <span class='kw'>efficacy_hurdle</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>toxicity_hurdle</span> <span class='kw'>=</span> <span class='fl'>0.3</span>,
                      <span class='kw'>p_e</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='kw'>p_t</span> <span class='kw'>=</span> <span class='fl'>0.1</span>,
                      <span class='kw'>eff0</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>tox1</span> <span class='kw'>=</span> <span class='fl'>0.65</span>,
                      <span class='kw'>eff_star</span> <span class='kw'>=</span> <span class='fl'>0.7</span>, <span class='kw'>tox_star</span> <span class='kw'>=</span> <span class='fl'>0.25</span>,
                      <span class='kw'>alpha_mean</span> <span class='kw'>=</span> -<span class='fl'>7.9593</span>, <span class='kw'>alpha_sd</span> <span class='kw'>=</span> <span class='fl'>3.5487</span>,
                      <span class='kw'>beta_mean</span> <span class='kw'>=</span> <span class='fl'>1.5482</span>, <span class='kw'>beta_sd</span> <span class='kw'>=</span> <span class='fl'>3.5018</span>,
                      <span class='kw'>gamma_mean</span> <span class='kw'>=</span> <span class='fl'>0.7367</span>, <span class='kw'>gamma_sd</span> <span class='kw'>=</span> <span class='fl'>2.5423</span>,
                      <span class='kw'>zeta_mean</span> <span class='kw'>=</span> <span class='fl'>3.4181</span>, <span class='kw'>zeta_sd</span> <span class='kw'>=</span> <span class='fl'>2.4406</span>,
                      <span class='kw'>eta_mean</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>eta_sd</span> <span class='kw'>=</span> <span class='fl'>0.2</span>,
                      <span class='kw'>psi_mean</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>psi_sd</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='fl'>123</span>)



<span class='co'># Calculate paths for the next two cohorts of 2, in an in-progress trial</span>
<span class='co'># Warning: this create 100 paths. It will run for a minute or two.</span>
<span class='no'>paths2</span> <span class='kw'>&lt;-</span> <span class='fu'>efftox_dtps</span>(<span class='kw'>cohort_sizes</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>2</span>, <span class='fl'>2</span>),
                      <span class='kw'>previous_outcomes</span> <span class='kw'>=</span> <span class='st'>'1NN 2EE'</span>,
                      <span class='kw'>next_dose</span> <span class='kw'>=</span> <span class='fl'>1</span>,
                      <span class='kw'>real_doses</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>1.0</span>, <span class='fl'>2.0</span>, <span class='fl'>4.0</span>, <span class='fl'>6.6</span>, <span class='fl'>10.0</span>),
                      <span class='kw'>efficacy_hurdle</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>toxicity_hurdle</span> <span class='kw'>=</span> <span class='fl'>0.3</span>,
                      <span class='kw'>p_e</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='kw'>p_t</span> <span class='kw'>=</span> <span class='fl'>0.1</span>,
                      <span class='kw'>eff0</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>tox1</span> <span class='kw'>=</span> <span class='fl'>0.65</span>,
                      <span class='kw'>eff_star</span> <span class='kw'>=</span> <span class='fl'>0.7</span>, <span class='kw'>tox_star</span> <span class='kw'>=</span> <span class='fl'>0.25</span>,
                      <span class='kw'>alpha_mean</span> <span class='kw'>=</span> -<span class='fl'>7.9593</span>, <span class='kw'>alpha_sd</span> <span class='kw'>=</span> <span class='fl'>3.5487</span>,
                      <span class='kw'>beta_mean</span> <span class='kw'>=</span> <span class='fl'>1.5482</span>, <span class='kw'>beta_sd</span> <span class='kw'>=</span> <span class='fl'>3.5018</span>,
                      <span class='kw'>gamma_mean</span> <span class='kw'>=</span> <span class='fl'>0.7367</span>, <span class='kw'>gamma_sd</span> <span class='kw'>=</span> <span class='fl'>2.5423</span>,
                      <span class='kw'>zeta_mean</span> <span class='kw'>=</span> <span class='fl'>3.4181</span>, <span class='kw'>zeta_sd</span> <span class='kw'>=</span> <span class='fl'>2.4406</span>,
                      <span class='kw'>eta_mean</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>eta_sd</span> <span class='kw'>=</span> <span class='fl'>0.2</span>,
                      <span class='kw'>psi_mean</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>psi_sd</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='fl'>123</span>,
                      <span class='kw'>i_am_patient</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='co'># Paths can be converted to a tibble</span>
<span class='fu'>library</span>(<span class='no'>tibble</span>)
<span class='fu'>library</span>(<span class='no'>dplyr</span>)
<span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span>(<span class='no'>paths2</span>)
<span class='no'>df</span> <span class='kw'>%&gt;%</span> <span class='fu'>print</span>(<span class='kw'>n</span> <span class='kw'>=</span> <span class='fl'>200</span>)

<span class='co'># And shaped in a wide format</span>
<span class='fu'><a href='spread_paths.html'>spread_paths</a></span>(<span class='no'>df</span> <span class='kw'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span>(-<span class='no'>fit</span>, -<span class='no'>parent_fit</span>, -<span class='no'>dose_index</span>)) <span class='kw'>%&gt;%</span>
  <span class='fu'>print</span>(<span class='kw'>n</span> <span class='kw'>=</span> <span class='fl'>100</span>)
<span class='co'># Incredibly, there are 100 ways these two cohorts of two can end up.</span>



<span class='co'># An example with a custom dose selection function.</span>
<span class='co'># Define a function to select the maximal utility dose, no matter what.</span>
<span class='co'># Note: this diverges from the original authors' intentions; we provide this</span>
<span class='co'># for illustration only!</span>
<span class='no'>max_utility_dose</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>efftox_fit</span>) {
  <span class='fu'>return</span>(<span class='fu'>which.max</span>(<span class='no'>efftox_fit</span>$<span class='no'>utility</span>))
}
<span class='co'># Fit the paths, providing the user_dose_func parameter</span>
<span class='co'># Warning: this create 100 paths. It will run for a minute or two.</span>
<span class='no'>paths3</span> <span class='kw'>&lt;-</span> <span class='fu'>efftox_dtps</span>(<span class='kw'>cohort_sizes</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>2</span>, <span class='fl'>2</span>),
                      <span class='kw'>previous_outcomes</span> <span class='kw'>=</span> <span class='st'>'1NN 2EE'</span>,
                      <span class='kw'>next_dose</span> <span class='kw'>=</span> <span class='fl'>1</span>,
                      <span class='kw'>real_doses</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>1.0</span>, <span class='fl'>2.0</span>, <span class='fl'>4.0</span>, <span class='fl'>6.6</span>, <span class='fl'>10.0</span>),
                      <span class='kw'>efficacy_hurdle</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>toxicity_hurdle</span> <span class='kw'>=</span> <span class='fl'>0.3</span>,
                      <span class='kw'>p_e</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='kw'>p_t</span> <span class='kw'>=</span> <span class='fl'>0.1</span>,
                      <span class='kw'>eff0</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>tox1</span> <span class='kw'>=</span> <span class='fl'>0.65</span>,
                      <span class='kw'>eff_star</span> <span class='kw'>=</span> <span class='fl'>0.7</span>, <span class='kw'>tox_star</span> <span class='kw'>=</span> <span class='fl'>0.25</span>,
                      <span class='kw'>alpha_mean</span> <span class='kw'>=</span> -<span class='fl'>7.9593</span>, <span class='kw'>alpha_sd</span> <span class='kw'>=</span> <span class='fl'>3.5487</span>,
                      <span class='kw'>beta_mean</span> <span class='kw'>=</span> <span class='fl'>1.5482</span>, <span class='kw'>beta_sd</span> <span class='kw'>=</span> <span class='fl'>3.5018</span>,
                      <span class='kw'>gamma_mean</span> <span class='kw'>=</span> <span class='fl'>0.7367</span>, <span class='kw'>gamma_sd</span> <span class='kw'>=</span> <span class='fl'>2.5423</span>,
                      <span class='kw'>zeta_mean</span> <span class='kw'>=</span> <span class='fl'>3.4181</span>, <span class='kw'>zeta_sd</span> <span class='kw'>=</span> <span class='fl'>2.4406</span>,
                      <span class='kw'>eta_mean</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>eta_sd</span> <span class='kw'>=</span> <span class='fl'>0.2</span>,
                      <span class='kw'>psi_mean</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>psi_sd</span> <span class='kw'>=</span> <span class='fl'>1</span>,
                      <span class='kw'>user_dose_func</span> <span class='kw'>=</span> <span class='no'>max_utility_dose</span>,
                      <span class='kw'>seed</span> <span class='kw'>=</span> <span class='fl'>123</span>, <span class='kw'>i_am_patient</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='co'># We can see where the dose-selections differ at the second future cohort</span>
<span class='co'># by joining these paths to those calculated in the previous example:</span>
<span class='fu'><a href='https://dplyr.tidyverse.org/reference/join.html'>left_join</a></span>(
  <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span>(<span class='no'>paths2</span>)<span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span>(<span class='no'>.node</span>, <span class='no'>.parent</span>, <span class='no'>.depth</span>, <span class='no'>outcomes</span>, <span class='kw'>model_dose</span> <span class='kw'>=</span> <span class='no'>next_dose</span>),
  <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span>(<span class='no'>paths3</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span>(<span class='no'>.node</span>, <span class='kw'>user_dose</span> <span class='kw'>=</span> <span class='no'>next_dose</span>),
  <span class='kw'>by</span> <span class='kw'>=</span> <span class='st'>'.node'</span>
) <span class='kw'>%&gt;%</span> <span class='fu'><a href='spread_paths.html'>spread_paths</a></span>() <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>model_dose2</span> <span class='kw'>!=</span> <span class='no'>user_dose2</span>)
<span class='co'># They differ in many places. The user defined functions sometimes selects</span>
<span class='co'># higher doses; sometimes lower.</span>
<span class='co'># }</span><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Kristian Brock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

