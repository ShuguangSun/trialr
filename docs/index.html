<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clinical Trial Designs in rstan • trialr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Clinical Trial Designs in rstan">
<meta property="og:description" content="A collection of clinical trial designs and methods, implemented in 
    rstan and R, including: the Continual Reassessment Method by OQuigley et 
    al. (1990) &lt;doi:10.2307/2531628&gt;; EffTox by Thall &amp; Cook (2004) 
    &lt;doi:10.1111/j.0006-341X.2004.00218.x&gt;; the two-parameter logistic method of
    Neuenschwander, Branson &amp; Sponer (2008) &lt;doi:10.1002/sim.3230&gt;; and the 
    Augmented Binary method by Wason &amp; Seaman (2013) &lt;doi:10.1002/sim.5867&gt;; and
    more. We provide functions to aid model-fitting and analysis. 
    The rstan' implementations may also serve as a cookbook to anyone looking 
    to extend or embellish these models. We hope that this package encourages 
    the use of Bayesian methods in clinical trials. There is a preponderance of 
    early phase trial designs because this is where Bayesian methods are used 
    most. If there is a method you would like implemented, please get in touch.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">trialr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/A200-CRM.html">Continual Reassessment Method</a>
    </li>
    <li>
      <a href="articles/A210-CRM-visualisation.html">Visualisation with CRM</a>
    </li>
    <li>
      <a href="articles/A220-CRM-pathways.html">Dose pathways with CRM</a>
    </li>
    <li>
      <a href="articles/A250-LevyCaseStudy.html">CRM Case Study 1 - Levy et al (2006)</a>
    </li>
    <li>
      <a href="articles/A260-TITE-CRM.html">Time-to-Event Continual Reassessment Method</a>
    </li>
    <li>
      <a href="articles/A300-NeuenschwanderBransonGsponer.html">Two-parameter logistic model for dose-finding by Neuenschwander, Branson &amp; Gsponer</a>
    </li>
    <li>
      <a href="articles/A400-EffTox.html">EffTox</a>
    </li>
    <li>
      <a href="articles/A500-HierarchicalBayesianResponse.html">Hierarchical Bayesian Model for Binary Responses</a>
    </li>
    <li>
      <a href="articles/A600-BEBOP.html">BEBOP in PePS2</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/brockk/trialr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="trialr---clinical-trial-designs-in-rstan" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#trialr---clinical-trial-designs-in-rstan" class="anchor"></a>trialr - Clinical Trial Designs in <code>RStan</code>
</h1></div>
<p>Kritian Brock</p>
<!-- README.md is generated from README.Rmd. Please edit that file -->
</div>
<div id="trialr" class="section level1">
<h1 class="hasAnchor">
<a href="#trialr" class="anchor"></a>trialr</h1>
<p><a href="https://cran.r-project.org/package=trialr"><img src="http://www.r-pkg.org/badges/version/trialr" alt="cran version"></a> <img src="https://cranlogs.r-pkg.org/badges/trialr"><img src="https://cranlogs.r-pkg.org/badges/grand-total/trialr"></p>
<p><code>trialr</code> is a collection of Bayesian clinical trial designs implemented in Stan and R. The documentation is available at <a href="https://brockk.github.io/trialr/" class="uri">https://brockk.github.io/trialr/</a></p>
<p>There are many notable Bayesian designs and methods for clinical trials. However, one of the factors that has constrained their use is the availability of software. We present here some of the most popular, implemented and demonstrated in a consistent style, leveraging the powerful Stan environment for Bayesian computing.</p>
<p>Implementations exist in other R packages. Sometimes authors make available code with their publications. However, challenges to use still persist. Different methods are presented in disparate styles. Features implemented in one package for one design may be missing in another. Sometimes the technology chosen may only be available on a particular operating system, or the chosen technology may have fallen into disuse.</p>
<p><code>trialr</code> seeks to address these problems. Models are specified in <a href="https://mc-stan.org/">Stan</a>, a state-of-the-art environment for Bayesian analysis. It uses Hamiltonian Monte Carlo to take samples from the posterior distribution. This method is more efficient than Gibbs sampling and reliable inference can usually be performed on a few thousand posterior samples. R, Stan and <code>trialr</code> are each available on Mac, Linux, and Windows, so all of the examples presented here work on each operating system. Furthermore, Stan offers a very simple method to split the sampling across <em>n</em> cores, taking full advantage of the modern multicore processors.</p>
<p>The designs implemented in <code>trialr</code> are introduced briefly below, and developed more fully in vignettes. We focus on real-life usage, including:</p>
<ul>
<li>fitting models to observed data;</li>
<li>processing posterior samples using tidy principles to produce useful inferences;</li>
<li>and visualising inferences using modern <code>ggplot</code> graphics.</li>
</ul>
</div>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h1>
<p>In all examples, we will need to load <code>trialr</code></p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">trialr</span>)</pre></div>
<div id="crm" class="section level2">
<h2 class="hasAnchor">
<a href="#crm" class="anchor"></a>CRM</h2>
<p>The Continual Reassessment Method (CRM) was first published by O’Quigley, Pepe, and Fisher (1990). It assumes a smooth mathematical form for the dose-toxicity curve to conduct a dose-finding trial seeking a maximum tolerable dose. There are many variations to suit different clinical scenarios and the design has enjoyed relatively common use, although nowhere near as common as the ubiquitous and inferior 3+3 design.</p>
<p>We will demonstrate the method using a notional trial example. In a scenario of five doses, we seek the dose with probability of toxicity closest to 25% where our prior guesses of the rates of toxicity can be represented:</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="no">target</span> <span class="kw">&lt;-</span> <span class="fl">0.25</span>
<span class="no">skeleton</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.15</span>, <span class="fl">0.25</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>)</pre></div>
<p>Let us assume that we have already treated 2 patients each at doses 2, 3 and 4, having seen two toxicities at dose-level 4 and none elsewhere. What dose should we give to the next patient or cohort? We fit the data to the popular empiric variant of the CRM model:</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="no">fit1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/stan_crm.html">stan_crm</a></span>(<span class="kw">outcome_str</span> <span class="kw">=</span> <span class="st">'2NN 3NN 4TT'</span>, <span class="kw">skeleton</span> <span class="kw">=</span> <span class="no">skeleton</span>,
                 <span class="kw">target</span> <span class="kw">=</span> <span class="no">target</span>, <span class="kw">model</span> <span class="kw">=</span> <span class="st">'empiric'</span>, <span class="kw">beta_sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fl">1.34</span>),
                 <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">123</span>)</pre></div>
<p>The parameter <code>outcome_str = '2NN 3NN 4TT'</code> reflects that two patients each have been treated at doses 2, 3, and 4, and that the two patients at dose 4 had toxicity but the other patients did not.</p>
<p>The fitted model contains lots of useful of information:</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="no">fit1</span>
<span class="co">#&gt;   Patient Dose Toxicity Weight</span>
<span class="co">#&gt; 1       1    2        0      1</span>
<span class="co">#&gt; 2       2    2        0      1</span>
<span class="co">#&gt; 3       3    3        0      1</span>
<span class="co">#&gt; 4       4    3        0      1</span>
<span class="co">#&gt; 5       5    4        1      1</span>
<span class="co">#&gt; 6       6    4        1      1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Dose Skeleton N Tox ProbTox MedianProbTox ProbMTD</span>
<span class="co">#&gt; 1    1     0.05 0   0   0.108        0.0726  0.2140</span>
<span class="co">#&gt; 2    2     0.15 2   0   0.216        0.1900  0.2717</span>
<span class="co">#&gt; 3    3     0.25 2   0   0.310        0.2972  0.2657</span>
<span class="co">#&gt; 4    4     0.40 2   2   0.444        0.4484  0.2090</span>
<span class="co">#&gt; 5    5     0.60 0   0   0.624        0.6395  0.0395</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model targets a toxicity level of 0.25.</span>
<span class="co">#&gt; The dose with estimated toxicity probability closest to target is 2.</span>
<span class="co">#&gt; The dose most likely to be the MTD is 2.</span>
<span class="co">#&gt; Model entropy: 1.49</span></pre></div>
<div class="sourceCode" id="cb5"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidybayes</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)

<span class="no">fit1</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="http://mjskay.github.io/tidybayes/reference/spread_draws.html">spread_draws</a></span>(<span class="no">prob_tox</span>[<span class="no">Dose</span>]) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Dose</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">prob_tox</span>)) +
  <span class="fu"><a href="http://mjskay.github.io/tidybayes/reference/stat_interval.html">stat_interval</a></span>(<span class="kw">.width</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.5</span>, <span class="fl">.8</span>, <span class="fl">.95</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="st">'Prob(DLT)'</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Posterior dose-toxicity beliefs using empiric CRM'</span>)</pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png"><!-- --></p>
<p>Several variants of the CRM are implemented in ‘trialr’. These are demonstrated in the CRM vignette. Several visualisation techniques are illustrated in the <em>Visualisation in CRM</em> vignette. The time-to-event CRM is introduced in the TITE-CRM vignette.</p>
</div>
<div id="neuenschwander-branson--gsponer" class="section level2">
<h2 class="hasAnchor">
<a href="#neuenschwander-branson--gsponer" class="anchor"></a>Neuenschwander, Branson &amp; Gsponer</h2>
<p>Neuenschwander, Branson, and Gsponer (2008) introduced a two-parameter logistic model for dose-escalation. It shares many characteristics of the CRM models presented above but instead of a skeleton, it uses as a covariate the doses under investigation divided by some reference dose.</p>
<p>E.g., reproducing one of the analyses in their paper:</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="no">dose</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2.5</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">25</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">100</span>, <span class="fl">150</span>, <span class="fl">200</span>, <span class="fl">250</span>)
<span class="no">d_star</span> <span class="kw">&lt;-</span> <span class="fl">250</span>
<span class="no">target</span> <span class="kw">&lt;-</span> <span class="fl">0.30</span>

<span class="no">outcomes</span> <span class="kw">&lt;-</span> <span class="st">'1NNN 2NNNN 3NNNN 4NNNN 7TT'</span>
<span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/stan_nbg.html">stan_nbg</a></span>(<span class="kw">outcome_str</span> <span class="kw">=</span> <span class="no">outcomes</span>, <span class="kw">real_doses</span> <span class="kw">=</span> <span class="no">dose</span>, <span class="kw">d_star</span> <span class="kw">=</span> <span class="no">d_star</span>,
                <span class="kw">target</span> <span class="kw">=</span> <span class="no">target</span>, <span class="kw">alpha_mean</span> <span class="kw">=</span> <span class="fl">2.15</span>, <span class="kw">alpha_sd</span> <span class="kw">=</span> <span class="fl">0.84</span>,
                <span class="kw">beta_mean</span> <span class="kw">=</span> <span class="fl">0.52</span>, <span class="kw">beta_sd</span> <span class="kw">=</span> <span class="fl">0.8</span>, <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">2020</span>, <span class="kw">refresh</span> <span class="kw">=</span> <span class="fl">0</span>)

<span class="no">fit</span>
<span class="co">#&gt;    Patient Dose Toxicity Weight</span>
<span class="co">#&gt; 1        1    1        0      1</span>
<span class="co">#&gt; 2        2    1        0      1</span>
<span class="co">#&gt; 3        3    1        0      1</span>
<span class="co">#&gt; 4        4    2        0      1</span>
<span class="co">#&gt; 5        5    2        0      1</span>
<span class="co">#&gt; 6        6    2        0      1</span>
<span class="co">#&gt; 7        7    2        0      1</span>
<span class="co">#&gt; 8        8    3        0      1</span>
<span class="co">#&gt; 9        9    3        0      1</span>
<span class="co">#&gt; 10      10    3        0      1</span>
<span class="co">#&gt; 11      11    3        0      1</span>
<span class="co">#&gt; 12      12    4        0      1</span>
<span class="co">#&gt; 13      13    4        0      1</span>
<span class="co">#&gt; 14      14    4        0      1</span>
<span class="co">#&gt; 15      15    4        0      1</span>
<span class="co">#&gt; 16      16    7        1      1</span>
<span class="co">#&gt; 17      17    7        1      1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Dose N Tox ProbTox MedianProbTox ProbMTD</span>
<span class="co">#&gt; 1     1 3   0  0.0126       0.00563 0.00025</span>
<span class="co">#&gt; 2     2 4   0  0.0325       0.01967 0.00050</span>
<span class="co">#&gt; 3     3 4   0  0.0675       0.04934 0.02250</span>
<span class="co">#&gt; 4     4 4   0  0.1385       0.11863 0.10450</span>
<span class="co">#&gt; 5     5 0   0  0.2064       0.18937 0.16775</span>
<span class="co">#&gt; 6     6 0   0  0.2692       0.25641 0.17100</span>
<span class="co">#&gt; 7     7 2   2  0.3264       0.31878 0.14425</span>
<span class="co">#&gt; 8     8 0   0  0.3780       0.37409 0.16850</span>
<span class="co">#&gt; 9     9 0   0  0.4661       0.46884 0.12475</span>
<span class="co">#&gt; 10   10 0   0  0.5371       0.54698 0.07125</span>
<span class="co">#&gt; 11   11 0   0  0.6616       0.67700 0.02000</span>
<span class="co">#&gt; 12   12 0   0  0.7390       0.75753 0.00375</span>
<span class="co">#&gt; 13   13 0   0  0.8259       0.84691 0.00075</span>
<span class="co">#&gt; 14   14 0   0  0.8717       0.89297 0.00025</span>
<span class="co">#&gt; 15   15 0   0  0.8993       0.91986 0.00000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model targets a toxicity level of 0.3.</span>
<span class="co">#&gt; The dose with estimated toxicity probability closest to target is 7.</span>
<span class="co">#&gt; The dose most likely to be the MTD is 6.</span>
<span class="co">#&gt; Model entropy: 2.06</span></pre></div>
<p>This reproduces the inferences depicted in the lower right pane of Figure 1 in Neuenschwander, Branson, and Gsponer (2008).</p>
<p>For more, see the <em>Two-parameter logistic model for dose-finding by Neuenschwander, Branson &amp; Gsponer</em> vignette.</p>
</div>
<div id="efftox" class="section level2">
<h2 class="hasAnchor">
<a href="#efftox" class="anchor"></a>EffTox</h2>
<p>EffTox by Thall and Cook (2004) is a dose-finding design that uses binary efficacy and toxicity outcomes to select a dose with a high utility score. We present it briefly here but there is a much more thorough examination in the EffTox vignette.</p>
<p>For demonstration, we fit the model parameterisation introduced by Thall et al. (2014) to the following notional outcomes:</p>
<table class="table">
<thead><tr class="header">
<th align="center">Patient</th>
<th align="center">Dose-level</th>
<th align="center">Toxicity</th>
<th align="center">Efficacy</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb7"><pre class="r"><span class="no">outcomes</span> <span class="kw">&lt;-</span> <span class="st">'1NNE 2EEB'</span>
<span class="no">fit2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/stan_efftox_demo.html">stan_efftox_demo</a></span>(<span class="no">outcomes</span>, <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">123</span>)</pre></div>
<p>In an efficacy and toxicity dose-finding scenario, the number of patient outcomes has increased. It is possible that patients experience efficacy only (E), toxicity only (T), both (B) or neither (N).</p>
<div class="sourceCode" id="cb8"><pre class="r"><span class="no">fit2</span>
<span class="co">#&gt;   Patient Dose Toxicity Efficacy</span>
<span class="co">#&gt; 1       1    1        0        0</span>
<span class="co">#&gt; 2       2    1        0        0</span>
<span class="co">#&gt; 3       3    1        0        1</span>
<span class="co">#&gt; 4       4    2        0        1</span>
<span class="co">#&gt; 5       5    2        0        1</span>
<span class="co">#&gt; 6       6    2        1        1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Dose N ProbEff ProbTox ProbAccEff ProbAccTox Utility Acceptable ProbOBD</span>
<span class="co">#&gt; 1    1 3   0.402   0.088      0.333      0.927  -0.342       TRUE  0.0465</span>
<span class="co">#&gt; 2    2 3   0.789   0.103      0.943      0.921   0.412       TRUE  0.2625</span>
<span class="co">#&gt; 3    3 0   0.929   0.225      0.984      0.718   0.506       TRUE  0.2077</span>
<span class="co">#&gt; 4    4 0   0.955   0.315      0.983      0.617   0.420      FALSE  0.0620</span>
<span class="co">#&gt; 5    5 0   0.964   0.372      0.980      0.561   0.349      FALSE  0.4213</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model recommends selecting dose-level 3.</span>
<span class="co">#&gt; The dose most likely to be the OBD is 5.</span>
<span class="co">#&gt; Model entropy: 1.36</span></pre></div>
<p>In this example, after evaluation of our six patients, the dose advocated for the next group is dose-level 3. This is contained in the fitted object:</p>
<div class="sourceCode" id="cb9"><pre class="r"><span class="no">fit2</span>$<span class="no">recommended_dose</span>
<span class="co">#&gt; [1] 3</span></pre></div>
<p>This is not surprising because dose 3 has the highest utility score:</p>
<div class="sourceCode" id="cb10"><pre class="r"><span class="no">fit2</span>$<span class="no">utility</span>
<span class="co">#&gt; [1] -0.3418428  0.4120858  0.5064312  0.4199298  0.3493254</span></pre></div>
<p>Sometimes, doses other than the maximal-utility dose will be recommended because of the dose-admissibility rules. See the EffTox vignette and the original papers for more details.</p>
<p>Functions are provided to create useful plots. For instance, it is illuminating to plot the posterior means of the probabilities of efficacy and toxicity at each of the doses on the trade-off contours used to measure dose attractiveness. The five doses are shown in red. Doses closer to the lower-right corner have higher utility.</p>
<div class="sourceCode" id="cb11"><pre class="r"><span class="fu"><a href="reference/efftox_contour_plot.html">efftox_contour_plot</a></span>(<span class="no">fit2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">'EffTox utility contours'</span>)</pre></div>
<p><img src="reference/figures/README-unnamed-chunk-12-1.png"><!-- --></p>
<p>This example continues in the EffTox vignette. There are many publications related to EffTox, including Thall and Cook (2004) and Thall et al. (2014).</p>
</div>
<div id="hierachical-analysis-of-response-in-related-cohorts" class="section level2">
<h2 class="hasAnchor">
<a href="#hierachical-analysis-of-response-in-related-cohorts" class="anchor"></a>Hierachical analysis of response in related cohorts</h2>
<p>Sticking with Peter Thall’s huge contribution to Bayesian clinical trials, Thall et al. (2003) described a method for analysing treatment effects of a single intervention in several sub-types of a single disease.</p>
<p>We demonstrate the method for partially-pooling response rates to a single drug in various subtypes of sarcoma. This example is used in Thall et al. (2003). Fitting the data to the model:</p>
<div class="sourceCode" id="cb12"><pre class="r"><span class="no">fit3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/stan_hierarchical_response_thall.html">stan_hierarchical_response_thall</a></span>(
  <span class="kw">group_responses</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0</span>),
  <span class="kw">group_sizes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2</span> ,<span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">5</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">0</span>),
  <span class="kw">mu_mean</span> <span class="kw">=</span> -<span class="fl">1.3863</span>,
  <span class="kw">mu_sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fl">1</span> / <span class="fl">0.1</span>),
  <span class="kw">tau_alpha</span> <span class="kw">=</span> <span class="fl">2</span>,
  <span class="kw">tau_beta</span> <span class="kw">=</span> <span class="fl">20</span>)</pre></div>
<p><code>mu</code> and <code>tau</code> are mean and precision parameters for the partially-pooled effects in the model. <code>mu_mean</code> and <code>mu_sd</code> are hyperparameters for a normal prior, and <code>tau_alpha</code> and <code>tau_beta</code> are hyperparameters for an inverse gamma prior. This specification is described in the original model.</p>
<p>The returned object is the same type as the fits returned by rstan:</p>
<div class="sourceCode" id="cb13"><pre class="r"><span class="no">fit3</span>
<span class="co">#&gt; Inference for Stan model: ThallHierarchicalBinary.</span>
<span class="co">#&gt; 4 chains, each with iter=2000; warmup=1000; thin=1; </span>
<span class="co">#&gt; post-warmup draws per chain=1000, total post-warmup draws=4000.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                     mean se_mean    sd   2.5%    25%    50%    75%  97.5% n_eff</span>
<span class="co">#&gt; mu                 -0.04    0.03  1.38  -2.86  -0.89  -0.02   0.86   2.60  2295</span>
<span class="co">#&gt; sigma2             13.22    0.59 16.18   3.45   6.44   9.56  14.77  43.41   748</span>
<span class="co">#&gt; rho[1]             -0.03    0.07  3.87  -8.25  -2.26   0.08   2.29   7.20  3079</span>
<span class="co">#&gt; rho[2]             -3.03    0.06  2.63  -9.68  -4.20  -2.55  -1.31   0.69  1899</span>
<span class="co">#&gt; rho[3]              2.46    0.07  2.86  -1.87   0.65   2.06   3.83   9.13  1497</span>
<span class="co">#&gt; rho[4]             -0.31    0.01  0.79  -1.87  -0.82  -0.31   0.21   1.22  4031</span>
<span class="co">#&gt; rho[5]              3.76    0.06  2.42   0.59   2.11   3.31   4.78  10.04  1448</span>
<span class="co">#&gt; rho[6]             -0.09    0.07  3.85  -8.34  -2.27   0.02   2.27   7.41  3092</span>
<span class="co">#&gt; rho[7]              0.06    0.03  1.53  -2.90  -0.92   0.09   0.99   3.05  3658</span>
<span class="co">#&gt; rho[8]              0.75    0.02  1.31  -1.55  -0.12   0.65   1.52   3.65  2785</span>
<span class="co">#&gt; rho[9]             -2.43    0.07  2.91  -9.18  -3.86  -2.00  -0.50   2.09  1919</span>
<span class="co">#&gt; rho[10]             0.01    0.07  3.97  -7.85  -2.29   0.05   2.38   7.74  2982</span>
<span class="co">#&gt; sigma               3.38    0.05  1.33   1.86   2.54   3.09   3.84   6.59   819</span>
<span class="co">#&gt; prob_response[1]    0.50    0.01  0.38   0.00   0.09   0.52   0.91   1.00  3476</span>
<span class="co">#&gt; prob_response[2]    0.15    0.00  0.18   0.00   0.01   0.07   0.21   0.67  3817</span>
<span class="co">#&gt; prob_response[3]    0.78    0.00  0.25   0.13   0.66   0.89   0.98   1.00  4141</span>
<span class="co">#&gt; prob_response[4]    0.43    0.00  0.17   0.13   0.31   0.42   0.55   0.77  4036</span>
<span class="co">#&gt; prob_response[5]    0.92    0.00  0.10   0.64   0.89   0.96   0.99   1.00  3879</span>
<span class="co">#&gt; prob_response[6]    0.50    0.01  0.38   0.00   0.09   0.51   0.91   1.00  3564</span>
<span class="co">#&gt; prob_response[7]    0.51    0.00  0.27   0.05   0.28   0.52   0.73   0.95  3642</span>
<span class="co">#&gt; prob_response[8]    0.64    0.00  0.22   0.18   0.47   0.66   0.82   0.97  3040</span>
<span class="co">#&gt; prob_response[9]    0.23    0.00  0.26   0.00   0.02   0.12   0.38   0.89  3971</span>
<span class="co">#&gt; prob_response[10]   0.50    0.01  0.38   0.00   0.09   0.51   0.92   1.00  2970</span>
<span class="co">#&gt; lp__              -34.42    0.15  3.77 -43.20 -36.48 -33.86 -31.71 -28.88   611</span>
<span class="co">#&gt;                   Rhat</span>
<span class="co">#&gt; mu                   1</span>
<span class="co">#&gt; sigma2               1</span>
<span class="co">#&gt; rho[1]               1</span>
<span class="co">#&gt; rho[2]               1</span>
<span class="co">#&gt; rho[3]               1</span>
<span class="co">#&gt; rho[4]               1</span>
<span class="co">#&gt; rho[5]               1</span>
<span class="co">#&gt; rho[6]               1</span>
<span class="co">#&gt; rho[7]               1</span>
<span class="co">#&gt; rho[8]               1</span>
<span class="co">#&gt; rho[9]               1</span>
<span class="co">#&gt; rho[10]              1</span>
<span class="co">#&gt; sigma                1</span>
<span class="co">#&gt; prob_response[1]     1</span>
<span class="co">#&gt; prob_response[2]     1</span>
<span class="co">#&gt; prob_response[3]     1</span>
<span class="co">#&gt; prob_response[4]     1</span>
<span class="co">#&gt; prob_response[5]     1</span>
<span class="co">#&gt; prob_response[6]     1</span>
<span class="co">#&gt; prob_response[7]     1</span>
<span class="co">#&gt; prob_response[8]     1</span>
<span class="co">#&gt; prob_response[9]     1</span>
<span class="co">#&gt; prob_response[10]    1</span>
<span class="co">#&gt; lp__                 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Thu Oct 15 09:52:56 2020.</span>
<span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="co">#&gt; convergence, Rhat=1).</span></pre></div>
<p>So, we can use the underlying plot method in <code>rstan</code>.</p>
<div class="sourceCode" id="cb14"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rstan</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">fit3</span>, <span class="kw">pars</span> <span class="kw">=</span> <span class="st">'prob_response'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span>(<span class="kw">xintercept</span> <span class="kw">=</span> <span class="fl">0.3</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'orange'</span>, <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">'dashed'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">'Partially-pooled response rates in 10 sarcoma subtypes'</span>)</pre></div>
<p><img src="reference/figures/README-unnamed-chunk-15-1.png"><!-- --></p>
<p>The hierarchical model for binary responses is developed in its own vignette.</p>
</div>
<div id="bebop-in-peps2" class="section level2">
<h2 class="hasAnchor">
<a href="#bebop-in-peps2" class="anchor"></a>BEBOP in PePS2</h2>
<p>Thall, Nguyen, and Estey (2008) introduced an extension of EffTox that allows dose-finding by efficacy and toxicity outcomes and adjusts for covariate information. Brock, et al. (manuscript accepted but not yet in press) simplified the method by removing the dose-finding components to leave a design that studies associated co-primary and toxicity outcomes in an arbitrary number of cohorts determined by the basline covariates. They refered to the simplifed design as BEBOP, for <em>Bayesian Evaluation of Bivariate binary Outcomes with Predictive variables</em>.</p>
<p>The investigators implement the design is a phase II trial of pembrolizumab in non-small-cell lung cancer. A distinct feature of the trial is the availability of predictive baseline covariates, the most noteworthy of which is the PD-L1 tumour proportion score, shown by Garon et al. (2015) to be a predictive biomarker for drug efficacy.</p>
<p>This example is demonstrated in the BEBOP vignette.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the latest trialr commit from github with:</p>
<div class="sourceCode" id="cb15"><pre class="r"><span class="co"># install.packages("devtools")</span>
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/devtools/man/reexports.html">install_github</a></span>(<span class="st">"brockk/trialr"</span>)</pre></div>
<p>You can install the latest CRAN release by running:</p>
<div class="sourceCode" id="cb16"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"trialr"</span>)</pre></div>
<p>It should go without saying that the CRAN release will be older than the github version.</p>
</div>
<div id="extending-trialr-and-getting-in-touch" class="section level2">
<h2 class="hasAnchor">
<a href="#extending-trialr-and-getting-in-touch" class="anchor"></a>Extending trialr and getting in touch</h2>
<p>If there is a published Bayesian design you want implemented in Stan, get in touch. Contact brockk on github.</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Garon2015">
<p>Garon, Edward B, Naiyer a Rizvi, Rina Hui, Natasha Leighl, Ani S Balmanoukian, Joseph Paul Eder, Amita Patnaik, et al. 2015. “Pembrolizumab for the Treatment of Non-Small-Cell Lung Cancer.” <em>The New England Journal of Medicine</em> 372 (21): 2018–28. <a href="https://doi.org/10.1056/NEJMoa1501824" class="uri">https://doi.org/10.1056/NEJMoa1501824</a>.</p>
</div>
<div id="ref-neuenschwanderCriticalAspectsBayesian2008">
<p>Neuenschwander, Beat, Michael Branson, and Thomas Gsponer. 2008. “Critical Aspects of the Bayesian Approach to Phase I Cancer Trials.” <em>Statistics in Medicine</em> 27 (13): 2420–39. <a href="https://doi.org/10.1002/sim.3230" class="uri">https://doi.org/10.1002/sim.3230</a>.</p>
</div>
<div id="ref-OQuigley1990">
<p>O’Quigley, J, M Pepe, and L Fisher. 1990. “Continual Reassessment Method: A Practical Design for Phase 1 Clinical Trials in Cancer.” <em>Biometrics</em> 46 (1): 33–48. <a href="https://doi.org/10.2307/2531628" class="uri">https://doi.org/10.2307/2531628</a>.</p>
</div>
<div id="ref-Thall2008">
<p>Thall, Peter F., Hoang Q. Nguyen, and Elihu H. Estey. 2008. “Patient-Specific Dose Finding Based on Bivariate Outcomes and Covariates.” <em>Biometrics</em> 64 (4): 1126–36. <a href="https://doi.org/10.1111/j.1541-0420.2008.01009.x" class="uri">https://doi.org/10.1111/j.1541-0420.2008.01009.x</a>.</p>
</div>
<div id="ref-Thall2003">
<p>Thall, Peter F., J. Kyle Wathen, B. Nebiyou Bekele, Richard E. Champlin, Laurence H. Baker, and Robert S. Benjamin. 2003. “Hierarchical Bayesian Approaches to Phase II Trials in Diseases with Multiple Subtypes.” <em>Statistics in Medicine</em> 22 (5): 763–80. <a href="https://doi.org/10.1002/sim.1399" class="uri">https://doi.org/10.1002/sim.1399</a>.</p>
</div>
<div id="ref-Thall2004">
<p>Thall, PF, and JD Cook. 2004. “Dose-Finding Based on Efficacy-Toxicity Trade-Offs.” <em>Biometrics</em> 60 (3): 684–93.</p>
</div>
<div id="ref-Thall2014">
<p>Thall, PF, RC Herrick, HQ Nguyen, JJ Venier, and JC Norris. 2014. “Effective Sample Size for Computing Prior Hyperparameters in Bayesian Phase I-II Dose-Finding.” <em>Clinical Trials</em> 11 (6): 657–66. <a href="https://doi.org/10.1177/1740774514547397" class="uri">https://doi.org/10.1177/1740774514547397</a>.</p>
</div>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=trialr">https://​cloud.r-project.org/​package=trialr</a>
</li>
<li>Browse source code at <br><a href="https://github.com/brockk/trialr/">https://​github.com/​brockk/​trialr/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/brockk/trialr/issues">https://​github.com/​brockk/​trialr/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;=3)</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Kristian Brock <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-3921-0166" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Kristian Brock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
